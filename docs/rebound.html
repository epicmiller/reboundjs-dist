<!DOCTYPE html>

<html>
<head>
  <title>rebound.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>rebound.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <pre><code>Rebound.js <span class="hljs-number">0.0</span><span class="hljs-number">.47</span>
</code></pre>
            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <pre><code>(c) <span class="hljs-number">2015</span> Adam Miller
Rebound may be freely distributed under the MIT license.
For all details and documentation:
http:<span class="hljs-comment">//reboundjs.com</span>
</code></pre>
            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <h2 id="rebound-runtime">Rebound Runtime</h2>

            </div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>If Backbone isn’t preset on the page yet, or if <code>window.Rebound</code> is already
in use, throw an error</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">if</span>(!<span class="hljs-built_in">window</span>.Backbone) <span class="hljs-keyword">throw</span> <span class="hljs-string">"Backbone must be on the page for Rebound to load."</span>;
<span class="hljs-keyword">if</span>(!<span class="hljs-built_in">window</span>.Rebound) <span class="hljs-keyword">throw</span> <span class="hljs-string">"Global Rebound namespace already taken."</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Load our <strong>Utils</strong>, helper environment, <strong>Rebound Data</strong>,
<strong>Rebound Components</strong> and the <strong>Rebound Router</strong></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>import utils from <span class="hljs-string">"rebound-component/utils"</span>;
import helpers from <span class="hljs-string">"rebound-component/helpers"</span>;
import { Model, Collection, ComputedProperty } from <span class="hljs-string">"rebound-data/rebound-data"</span>;
import Component from <span class="hljs-string">"rebound-component/component"</span>;
import Router from <span class="hljs-string">"rebound-router/rebound-router"</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>If Backbone doesn’t have an ajax method from an external DOM library, use ours</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">window</span>.Backbone.ajax = <span class="hljs-built_in">window</span>.Backbone.$ &amp;&amp; <span class="hljs-built_in">window</span>.Backbone.$.ajax &amp;&amp; <span class="hljs-built_in">window</span>.Backbone.ajax || utils.ajax;</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Fetch Rebound’s Config Object from Rebound’s <code>script</code> tag</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> Config = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'Rebound'</span>).innerHTML;</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Create Global Rebound Object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-built_in">window</span>.Rebound = {
  registerHelper: helpers.registerHelper,
  registerPartial: helpers.registerPartial,
  registerComponent: Component.register,
  Model: Model,
  Collection: Collection,
  ComputedProperty: ComputedProperty,
  Component: Component
};</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>Start the router if a config object is preset</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">if</span>(Config) <span class="hljs-built_in">window</span>.Rebound.router = <span class="hljs-keyword">new</span> Router({config: <span class="hljs-built_in">JSON</span>.parse(Config)});

export <span class="hljs-keyword">default</span> Rebound;</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <h2 id="rebound-data">Rebound Data</h2>

            </div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>These are methods inherited by all Rebound data types – <strong>Models</strong>,
<strong>Collections</strong> and <strong>Computed Properties</strong> – and control tree ancestry
tracking, deep event propagation and tree destruction.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
import Model from <span class="hljs-string">"rebound-data/model"</span>;
import Collection from <span class="hljs-string">"rebound-data/collection"</span>;
import ComputedProperty from <span class="hljs-string">"rebound-data/computed-property"</span>;
import $ from <span class="hljs-string">"rebound-component/utils"</span>;

<span class="hljs-keyword">var</span> sharedMethods = {</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>When a change event propagates up the tree it modifies the path part of
<code>change:&lt;path&gt;</code> to reflect the fully qualified path relative to that object.
Ex: Would trigger <code>change:val</code>, <code>change:[0].val</code>, <code>change:arr[0].val</code> and <code>obj.arr[0].val</code>
on each parent as it is propagated up the tree.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  propagateEvent: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(type, model)</span></span>{
    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.__parent__ === <span class="hljs-keyword">this</span> || type === <span class="hljs-string">'dirty'</span>) <span class="hljs-keyword">return</span>;
    <span class="hljs-keyword">if</span>(type.indexOf(<span class="hljs-string">'change:'</span>) === <span class="hljs-number">0</span> &amp;&amp; model.isModel){
      <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.isCollection &amp;&amp; ~type.indexOf(<span class="hljs-string">'change:['</span>)) <span class="hljs-keyword">return</span>;
      <span class="hljs-keyword">var</span> key,
          path = model.__path().replace(<span class="hljs-keyword">this</span>.__parent__.__path(), <span class="hljs-string">''</span>).replace(<span class="hljs-regexp">/^\./</span>, <span class="hljs-string">''</span>),
          changed = model.changedAttributes();

      <span class="hljs-keyword">for</span>(key <span class="hljs-keyword">in</span> changed){
        <span class="hljs-built_in">arguments</span>[<span class="hljs-number">0</span>] = (<span class="hljs-string">'change:'</span> + path + (path &amp;&amp; <span class="hljs-string">'.'</span>) + key); <span class="hljs-comment">// jshint ignore:line</span>
        <span class="hljs-keyword">this</span>.__parent__.trigger.apply(<span class="hljs-keyword">this</span>.__parent__, <span class="hljs-built_in">arguments</span>);
      }
      <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.__parent__.trigger.apply(<span class="hljs-keyword">this</span>.__parent__, <span class="hljs-built_in">arguments</span>);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Set this data object’s parent to <code>parent</code> and, as long as a data object is
not its own parent, propagate every event triggered on <code>this</code> up the tree.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  setParent: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(parent)</span></span>{
    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.__parent__) <span class="hljs-keyword">this</span>.off(<span class="hljs-string">'all'</span>, <span class="hljs-keyword">this</span>.propagateEvent);
    <span class="hljs-keyword">this</span>.__parent__ = parent;
    <span class="hljs-keyword">this</span>._hasAncestry = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">if</span>(parent !== <span class="hljs-keyword">this</span>) <span class="hljs-keyword">this</span>.on(<span class="hljs-string">'all'</span>, <span class="hljs-keyword">this</span>.__parent__.propagateEvent);
    <span class="hljs-keyword">return</span> parent;
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Recursively set a data tree’s root element starting with <code>this</code> to the deepest child.
TODO: I dont like this recursively setting elements root when one element’s root changes. Fix this.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  setRoot: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(root)</span></span>{
    <span class="hljs-keyword">var</span> obj = <span class="hljs-keyword">this</span>;
    obj.__root__ = root;
    <span class="hljs-keyword">var</span> val = obj.models ||  obj.attributes || obj.cache;
    _.each(val, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(value, key)</span></span>{
      <span class="hljs-keyword">if</span>(value &amp;&amp; value.isData){
        value.setRoot(root);
      }
    });
    <span class="hljs-keyword">return</span> root;
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Tests to see if <code>this</code> has a parent <code>obj</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  hasParent: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(obj)</span></span>{
    <span class="hljs-keyword">var</span> tmp = <span class="hljs-keyword">this</span>;
    <span class="hljs-keyword">while</span>(tmp !== obj){
      tmp = tmp.__parent__;
      <span class="hljs-keyword">if</span>(_.isUndefined(tmp)) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">if</span>(tmp === obj) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
      <span class="hljs-keyword">if</span>(tmp.__parent__ === tmp) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>De-initializes a data tree starting with <code>this</code> and recursively calling <code>deinitialize()</code> on each child.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  deinitialize: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>Undelegate Backbone Events from this data object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.undelegateEvents) <span class="hljs-keyword">this</span>.undelegateEvents();
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.stopListening) <span class="hljs-keyword">this</span>.stopListening();
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.off) <span class="hljs-keyword">this</span>.off();</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Destroy this data object’s lineage</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.__parent__;
    <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.__root__;
    <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.__path;</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>If there is a dom element associated with this data object, destroy all listeners associated with it.
Remove all event listeners from this dom element, recursively remove element lazyvalues,
and then remove the element referance itself.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.el){
      _.each(<span class="hljs-keyword">this</span>.el.__listeners, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(handler, eventType)</span></span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.el.removeEventListener) <span class="hljs-keyword">this</span>.el.removeEventListener(eventType, handler, <span class="hljs-literal">false</span>);
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.el.detachEvent) <span class="hljs-keyword">this</span>.el.detachEvent(<span class="hljs-string">'on'</span>+eventType, handler);
      }, <span class="hljs-keyword">this</span>);
      $(<span class="hljs-keyword">this</span>.el).walkTheDOM(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(el)</span></span>{
        <span class="hljs-keyword">if</span>(el.__lazyValue &amp;&amp; el.__lazyValue.destroy()) n.__lazyValue.destroy();
      });
      <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.el.__listeners;
      <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.el.__events;
      <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.$el;
      <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.el;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Clean up Hook callback references</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.__observers;</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Mark as deinitialized so we don’t loop on cyclic dependancies.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.deinitialized = <span class="hljs-literal">true</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Destroy all children of this data object.
If a Collection, de-init all of its Models, if a Model, de-init all of its
Attributes, if a Computed Property, de-init its Cache objects.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _.each(<span class="hljs-keyword">this</span>.models, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(val)</span> </span>{ val &amp;&amp; val.deinitialize &amp;&amp; val.deinitialize(); });
    _.each(<span class="hljs-keyword">this</span>.attributes, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(val)</span> </span>{ val &amp;&amp; val.deinitialize &amp;&amp; val.deinitialize();});
    <span class="hljs-keyword">this</span>.cache &amp;&amp; <span class="hljs-keyword">this</span>.cache.collection.deinitialize();
    <span class="hljs-keyword">this</span>.cache &amp;&amp; <span class="hljs-keyword">this</span>.cache.model.deinitialize();

  }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Extend all of the <strong>Rebound Data</strong> prototypes with these shared methods</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>_.extend(Model.prototype, sharedMethods);
_.extend(Collection.prototype, sharedMethods);
_.extend(ComputedProperty.prototype, sharedMethods);

export { Model, Collection, ComputedProperty };</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <h2 id="rebound-model">Rebound Model</h2>

            </div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              
            </div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Rebound <strong>Models</strong> are the basic data object in the framework — frequently
representing a row in a table in a database on your server. The inherit from
Backbone Models and have all of the same useful methods you are used to for
performing computations and transformations on that data. Rebound augments
Backbone Models by enabling deep data nesting. You can now have <strong>Rebound Collections</strong>
and <strong>Rebound Computed Properties</strong> as properties of the Model.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
import ComputedProperty from <span class="hljs-string">"rebound-data/computed-property"</span>;
import $ from <span class="hljs-string">"rebound-component/utils"</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Returns a function that, when called, generates a path constructed from its
parent’s path and the key it is assigned to. Keeps us from re-naming children
when parents change.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pathGenerator</span><span class="hljs-params">(parent, key)</span></span>{
  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    <span class="hljs-keyword">var</span> path = parent.__path();
    <span class="hljs-keyword">return</span> path + ((path === <span class="hljs-string">''</span>) ? <span class="hljs-string">''</span> : <span class="hljs-string">'.'</span>) + key;
  };
}

<span class="hljs-keyword">var</span> Model = Backbone.Model.extend({</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Set this object’s data types</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  isModel: <span class="hljs-literal">true</span>,
  isData: <span class="hljs-literal">true</span>,</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>A method that returns a root path by default. Meant to be overridden on
instantiation.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  __path: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{ <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>; },</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Create a new Model with the specified attributes. The Model’s lineage is set
up here to keep track of it’s place in the data tree.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  constructor: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(attributes, options)</span></span>{
    attributes || (attributes = {});
    attributes.isModel &amp;&amp; (attributes = attributes.attributes);
    options || (options = {});
    <span class="hljs-keyword">this</span>.helpers = {};
    <span class="hljs-keyword">this</span>.defaults = <span class="hljs-keyword">this</span>.defaults || {};
    <span class="hljs-keyword">this</span>.setParent( options.parent || <span class="hljs-keyword">this</span> );
    <span class="hljs-keyword">this</span>.setRoot( options.root || <span class="hljs-keyword">this</span> );
    <span class="hljs-keyword">this</span>.__path = options.path || <span class="hljs-keyword">this</span>.__path;
    Backbone.Model.call( <span class="hljs-keyword">this</span>, attributes, options );
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>New convenience function to toggle boolean values in the Model.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  toggle: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(attr, options)</span> </span>{
    options = options ? _.clone(options) : {};
    <span class="hljs-keyword">var</span> val = <span class="hljs-keyword">this</span>.get(attr);
    <span class="hljs-keyword">if</span>(!_.isBoolean(val)) <span class="hljs-built_in">console</span>.error(<span class="hljs-string">'Tried to toggle non-boolean value '</span> + attr +<span class="hljs-string">'!'</span>, <span class="hljs-keyword">this</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.set(attr, !val, options);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Model Reset does a deep reset on the data tree starting at this Model.
A <code>previousAttributes</code> property is set on the <code>options</code> property with the Model’s
old values.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  reset: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(obj, options)</span></span>{
    <span class="hljs-keyword">var</span> changed = {}, key, value;
    options || (options = {});
    options.reset = <span class="hljs-literal">true</span>;
    obj = (obj &amp;&amp; obj.isModel &amp;&amp; obj.attributes) || obj || {};
    options.previousAttributes = _.clone(<span class="hljs-keyword">this</span>.attributes);</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Iterate over the Model’s attributes:</p>
<ul>
<li>If the property is the <code>idAttribute</code>, skip.</li>
<li>If the property is a <code>Model</code>, <code>Collection</code>, or <code>ComputedProperty</code>, reset it.</li>
<li>If the passed object has the property, set it to the new value.</li>
<li>If the Model has a default value for this property, set it back to default.</li>
<li>Otherwise, unset the attribute.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span>(key <span class="hljs-keyword">in</span> <span class="hljs-keyword">this</span>.attributes){
      value = <span class="hljs-keyword">this</span>.attributes[key];
      <span class="hljs-keyword">if</span>(value === obj[key]) <span class="hljs-keyword">continue</span>;
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(_.isUndefined(value)) obj[key] &amp;&amp; (changed[key] = obj[key]);
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (key === <span class="hljs-keyword">this</span>.idAttribute) <span class="hljs-keyword">continue</span>;
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (value.isCollection || value.isModel || value.isComputedProperty){
        value.reset((obj[key]||[]), {silent: <span class="hljs-literal">true</span>});
        <span class="hljs-keyword">if</span>(value.isCollection) changed[key] = [];
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(value.isModel &amp;&amp; value.isComputedProperty) changed[key] = value.cache.model.changed;
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(value.isModel) changed[key] = value.changed
      }
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (obj.hasOwnProperty(key)){ changed[key] = obj[key]; }
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.defaults.hasOwnProperty(key) &amp;&amp; !_.isFunction(<span class="hljs-keyword">this</span>.defaults[key])){
        changed[key] = obj[key] = <span class="hljs-keyword">this</span>.defaults[key];
      }
      <span class="hljs-keyword">else</span>{
        changed[key] = <span class="hljs-literal">undefined</span>;
        <span class="hljs-keyword">this</span>.unset(key, {silent: <span class="hljs-literal">true</span>});
      }
    };</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Any unset changed values will be set to obj[key]</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _.each(obj, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(value, key, obj)</span></span>{
      changed[key] = changed[key] || obj[key];
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Reset our model</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    obj = <span class="hljs-keyword">this</span>.set(obj, _.extend({}, options, {silent: <span class="hljs-literal">true</span>, reset: <span class="hljs-literal">false</span>}));</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Trigger custom reset event</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.changed = changed;
    <span class="hljs-keyword">if</span> (!options.silent) <span class="hljs-keyword">this</span>.trigger(<span class="hljs-string">'reset'</span>, <span class="hljs-keyword">this</span>, options);</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>Return new values</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">return</span> obj;
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p><strong>Model.Get</strong> is overridden to provide support for getting from a deep data tree.
<code>key</code> may now be any valid json-like identifier. Ex: <code>obj.coll[3].value</code>.
It needs to traverse <code>Models</code>, <code>Collections</code> and <code>Computed Properties</code> to
find the correct value.</p>
<ul>
<li>If key is undefined, return <code>undefined</code>.</li>
<li>If key is empty string, return <code>this</code>.</li>
</ul>
<p>For each part:</p>
<ul>
<li>If a <code>Computed Property</code> and <code>options.raw</code> is true, return it.</li>
<li>If a <code>Computed Property</code> traverse to its value.</li>
<li>If not set, return its falsy value.</li>
<li>If a <code>Model</code>, <code>Collection</code>, or primitive value, traverse to it.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>  get: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(key, options)</span></span>{
    options || (options = {});
    <span class="hljs-keyword">var</span> parts  = $.splitPath(key),
        result = <span class="hljs-keyword">this</span>,
        i, l=parts.length;

    <span class="hljs-keyword">if</span>(_.isUndefined(key) || _.isNull(key)) <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;
    <span class="hljs-keyword">if</span>(key === <span class="hljs-string">''</span> || parts.length === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> result;

    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; l; i++) {
      <span class="hljs-keyword">if</span>(result &amp;&amp; result.isComputedProperty &amp;&amp; options.raw) <span class="hljs-keyword">return</span> result;
      <span class="hljs-keyword">if</span>(result &amp;&amp; result.isComputedProperty) result = result.value();
      <span class="hljs-keyword">if</span>(_.isUndefined(result) || _.isNull(result)) <span class="hljs-keyword">return</span> result;
      <span class="hljs-keyword">if</span>(parts[i] === <span class="hljs-string">'@parent'</span>) result = result.__parent__;
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(result.isCollection) result = result.models[parts[i]];
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(result.isModel) result = result.attributes[parts[i]];
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(result &amp;&amp; result.hasOwnProperty(parts[i])) result = result[parts[i]];
    }

    <span class="hljs-keyword">if</span>(result &amp;&amp; result.isComputedProperty &amp;&amp; !options.raw) result = result.value();
    <span class="hljs-keyword">return</span> result;
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p><strong>Model.Set</strong> is overridden to provide support for getting from a deep data tree.
<code>key</code> may now be any valid json-like identifier. Ex: <code>obj.coll[3].value</code>.
It needs to traverse <code>Models</code>, <code>Collections</code> and <code>Computed Properties</code> to
find the correct value to call the original <code>Backbone.Set</code> on.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  set: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(key, val, options)</span></span>{

    <span class="hljs-keyword">var</span> attrs, attr, newKey, target, destination, props = [], lineage;

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> key === <span class="hljs-string">'object'</span>) {
      attrs = (key.isModel) ? key.attributes : key;
      options = val;
    }
    <span class="hljs-keyword">else</span> (attrs = {})[key] = val;
    options || (options = {});</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>If reset option passed, do a reset. If nothing passed, return.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span>(options.reset === <span class="hljs-literal">true</span>) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.reset(attrs, options);
    <span class="hljs-keyword">if</span>(options.defaults === <span class="hljs-literal">true</span>) <span class="hljs-keyword">this</span>.defaults = attrs;
    <span class="hljs-keyword">if</span>(_.isEmpty(attrs)) <span class="hljs-keyword">return</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>For each attribute passed:</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span>(key <span class="hljs-keyword">in</span> attrs){
      <span class="hljs-keyword">var</span> val = attrs[key],
          paths = $.splitPath(key),
          attr  = paths.pop() || <span class="hljs-string">''</span>;           <span class="hljs-comment">// The key        ex: foo[0].bar --&gt; bar</span>
          target = <span class="hljs-keyword">this</span>.get(paths.join(<span class="hljs-string">'.'</span>)),  <span class="hljs-comment">// The element    ex: foo.bar.baz --&gt; foo.bar</span>
          lineage;</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>If target currently doesnt exist, construct its tree</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span>(_.isUndefined(target)){
        target = <span class="hljs-keyword">this</span>;
        _.each(paths, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(value)</span></span>{
          <span class="hljs-keyword">var</span> tmp = target.get(value);
          <span class="hljs-keyword">if</span>(_.isUndefined(tmp)) tmp = target.set(value, {}).get(value);
          target = tmp;
        }, <span class="hljs-keyword">this</span>);
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>The old value of <code>attr</code> in <code>target</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> destination = target.get(attr, {raw: <span class="hljs-literal">true</span>}) || {};</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>Create this new object’s lineage.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      lineage = {
        name: key,
        parent: target,
        root: <span class="hljs-keyword">this</span>.__root__,
        path: pathGenerator(target, key),
        silent: <span class="hljs-literal">true</span>,
        defaults: options.defaults
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <ul>
<li>If val is <code>null</code> or <code>undefined</code>, set to default value.</li>
<li>If val is a <code>Computed Property</code>, get its current cache object.</li>
<li>If val is <code>null</code>, set to default value or (fallback <code>undefined</code>).</li>
<li>Else If this function is the same as the current computed property, continue.</li>
<li>Else If this value is a <code>Function</code>, turn it into a <code>Computed Property</code>.</li>
<li>Else If this is going to be a cyclical dependancy, use the original object, don’t make a copy.</li>
<li>Else If updating an existing object with its respective data type, let Backbone handle the merge.</li>
<li>Else If this value is a <code>Model</code> or <code>Collection</code>, create a new copy of it using its constructor, preserving its defaults while ensuring no shared memory between objects.</li>
<li>Else If this value is an <code>Array</code>, turn it into a <code>Collection</code>.</li>
<li>Else If this value is a <code>Object</code>, turn it into a <code>Model</code>.</li>
<li>Else val is a primitive value, set it accordingly.</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>


      <span class="hljs-keyword">if</span>(_.isNull(val) || _.isUndefined(val)) val = <span class="hljs-keyword">this</span>.defaults[key];
      <span class="hljs-keyword">if</span>(val &amp;&amp; val.isComputedProperty) val = val.value();
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(_.isNull(val) || _.isUndefined(val)) val = <span class="hljs-literal">undefined</span>;
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(destination.isComputedProperty &amp;&amp; destination.func === val) <span class="hljs-keyword">continue</span>;
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(_.isFunction(val)) val = <span class="hljs-keyword">new</span> ComputedProperty(val, lineage);
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(val.isData &amp;&amp; target.hasParent(val)) val = val;
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>( destination.isComputedProperty ||
              ( destination.isCollection &amp;&amp; ( _.isArray(val) || val.isCollection )) ||
              ( destination.isModel &amp;&amp; ( _.isObject(val) || val.isModel ))){
        destination.set(val, options);
        <span class="hljs-keyword">continue</span>;
      }
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(val.isData &amp;&amp; options.clone !== <span class="hljs-literal">false</span>) val = <span class="hljs-keyword">new</span> val.constructor(val.attributes || val.models, lineage);
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(_.isArray(val)) val = <span class="hljs-keyword">new</span> Rebound.Collection(val, lineage); <span class="hljs-comment">// TODO: Remove global referance</span>
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(_.isObject(val)) val = <span class="hljs-keyword">new</span> Model(val, lineage);</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>If val is a data object, let this object know it is now a parent</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">this</span>._hasAncestry = (val &amp;&amp; val.isData || <span class="hljs-literal">false</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>Set the value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      Backbone.Model.prototype.set.call(target, attr, val, options); <span class="hljs-comment">// TODO: Event cleanup when replacing a model or collection with another value</span>

    };

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;

  },</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>Recursive <code>toJSON</code> function traverses the data tree returning a JSON object.
If there are any cyclic dependancies the object’s <code>cid</code> is used instead of looping infinitely.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  toJSON: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._isSerializing) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.id || <span class="hljs-keyword">this</span>.cid;
      <span class="hljs-keyword">this</span>._isSerializing = <span class="hljs-literal">true</span>;
      <span class="hljs-keyword">var</span> json = _.clone(<span class="hljs-keyword">this</span>.attributes);
      _.each(json, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(value, name)</span> </span>{
          <span class="hljs-keyword">if</span>( _.isNull(value) || _.isUndefined(value) ){ <span class="hljs-keyword">return</span>; }
          _.isFunction(value.toJSON) &amp;&amp; (json[name] = value.toJSON());
      });
      <span class="hljs-keyword">this</span>._isSerializing = <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">return</span> json;
  }

});

export <span class="hljs-keyword">default</span> Model;</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <h2 id="rebound-collection">Rebound Collection</h2>

            </div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
import Model from <span class="hljs-string">"rebound-data/model"</span>;
import $ from <span class="hljs-string">"rebound-component/utils"</span>;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pathGenerator</span><span class="hljs-params">(collection)</span></span>{
  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    <span class="hljs-keyword">return</span> collection.__path() + <span class="hljs-string">'['</span> + collection.indexOf(collection._byId[<span class="hljs-keyword">this</span>.cid]) + <span class="hljs-string">']'</span>;
  };
}

<span class="hljs-keyword">var</span> Collection = Backbone.Collection.extend({

  isCollection: <span class="hljs-literal">true</span>,
  isData: <span class="hljs-literal">true</span>,

  model: <span class="hljs-keyword">this</span>.model || Model,

  __path: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{<span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;},

  constructor: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(models, options)</span></span>{
    models || (models = []);
    options || (options = {});
    <span class="hljs-keyword">this</span>.__observers = {};
    <span class="hljs-keyword">this</span>.helpers = {};
    <span class="hljs-keyword">this</span>.cid = _.uniqueId(<span class="hljs-string">'collection'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>Set lineage</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.setParent( options.parent || <span class="hljs-keyword">this</span> );
    <span class="hljs-keyword">this</span>.setRoot( options.root || <span class="hljs-keyword">this</span> );
    <span class="hljs-keyword">this</span>.__path = options.path || <span class="hljs-keyword">this</span>.__path;

    Backbone.Collection.apply( <span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span> );</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>When a model is removed from its original collection, destroy it
TODO: Fix this. Computed properties now somehow allow collection to share a model. They may be removed from one but not the other. That is bad.
The clone = false options is the culprit. Find a better way to copy all of the collections custom attributes over to the clone.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.on(<span class="hljs-string">'remove'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(model, collection, options)</span></span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>model.deinitialize();</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    });

  },

  get: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(key, options)</span></span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>If the key is a number or object, default to backbone’s collection get</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> key == <span class="hljs-string">'number'</span> || <span class="hljs-keyword">typeof</span> key == <span class="hljs-string">'object'</span>){
      <span class="hljs-keyword">return</span> Backbone.Collection.prototype.get.call(<span class="hljs-keyword">this</span>, key);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>If key is not a string, return undefined</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (!_.isString(key)) <span class="hljs-keyword">return</span> <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>Split the path at all ‘.’, ‘[‘ and ‘]’ and find the value referanced.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> parts  = $.splitPath(key),
        result = <span class="hljs-keyword">this</span>,
        l=parts.length,
        i=<span class="hljs-number">0</span>;
        options || (options = {});

    <span class="hljs-keyword">if</span>(_.isUndefined(key) || _.isNull(key)) <span class="hljs-keyword">return</span> key;
    <span class="hljs-keyword">if</span>(key === <span class="hljs-string">''</span> || parts.length === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> result;

    <span class="hljs-keyword">if</span> (parts.length &gt; <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; l; i++) {</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>If returning raw, always return the first computed property found. If undefined, you’re done.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span>(result &amp;&amp; result.isComputedProperty &amp;&amp; options.raw) <span class="hljs-keyword">return</span> result;
        <span class="hljs-keyword">if</span>(result &amp;&amp; result.isComputedProperty) result = result.value();
        <span class="hljs-keyword">if</span>(_.isUndefined(result) || _.isNull(result)) <span class="hljs-keyword">return</span> result;
        <span class="hljs-keyword">if</span>(parts[i] === <span class="hljs-string">'@parent'</span>) result = result.__parent__;
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(result.isCollection) result = result.models[parts[i]];
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(result.isModel) result = result.attributes[parts[i]];
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(result.hasOwnProperty(parts[i])) result = result[parts[i]];
      }
    }

    <span class="hljs-keyword">if</span>(result &amp;&amp; result.isComputedProperty &amp;&amp; !options.raw) result = result.value();

    <span class="hljs-keyword">return</span> result;
  },

  set: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(models, options)</span></span>{
    <span class="hljs-keyword">var</span> newModels = [],
        lineage = {
          parent: <span class="hljs-keyword">this</span>,
          root: <span class="hljs-keyword">this</span>.__root__,
          path: pathGenerator(<span class="hljs-keyword">this</span>),
          silent: <span class="hljs-literal">true</span>
        };
        options = options || {},</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>If no models passed, implies an empty array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    models || (models = []);</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>If models is a string, call set at that path</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span>(_.isString(models)) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.get($.splitPath(models)[<span class="hljs-number">0</span>]).set($.splitPath(models).splice(<span class="hljs-number">1</span>, models.length).join(<span class="hljs-string">'.'</span>), options);
    <span class="hljs-keyword">if</span>(!_.isObject(models)) <span class="hljs-keyword">return</span> <span class="hljs-built_in">console</span>.error(<span class="hljs-string">'Collection.set must be passed a Model, Object, array or Models and Objects, or another Collection'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>If another collection, treat like an array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    models = (models.isCollection) ? models.models : models;</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>Ensure models is an array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    models = (!_.isArray(models)) ? [models] : models;</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>If the model already exists in this collection, or we are told not to clone it, let Backbone handle the merge
Otherwise, create our copy of this model, give them the same cid so our helpers treat them as the same object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _.each(models, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data, index)</span></span>{
      <span class="hljs-keyword">if</span>(data.isModel &amp;&amp; options.clone === <span class="hljs-literal">false</span> || <span class="hljs-keyword">this</span>._byId[data.cid]) <span class="hljs-keyword">return</span> newModels[index] = data;
      newModels[index] = <span class="hljs-keyword">new</span> <span class="hljs-keyword">this</span>.model(data, _.defaults(lineage, options));
      data.isModel &amp;&amp; (newModels[index].cid = data.cid);
    }, <span class="hljs-keyword">this</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>Ensure that this element now knows that it has children now. Without this cyclic dependancies cause issues</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>._hasAncestry || (<span class="hljs-keyword">this</span>._hasAncestry = newModels.length &gt; <span class="hljs-number">0</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>Call original set function with model duplicates</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">return</span> Backbone.Collection.prototype.set.call(<span class="hljs-keyword">this</span>, newModels, options);

  }

});

export <span class="hljs-keyword">default</span> Collection;</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <h2 id="rebound-computed-property">Rebound Computed Property</h2>

            </div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
import propertyCompiler from <span class="hljs-string">"property-compiler/property-compiler"</span>;
import $ from <span class="hljs-string">"rebound-component/utils"</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>Returns true if str starts with test</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">startsWith</span><span class="hljs-params">(str, test)</span></span>{
  <span class="hljs-keyword">if</span>(str === test) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  <span class="hljs-keyword">return</span> str.substring(<span class="hljs-number">0</span>, test.length+<span class="hljs-number">1</span>) === test+<span class="hljs-string">'.'</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>Called after callstack is exausted to call all of this computed property’s
dependants that need to be recomputed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">recomputeCallback</span><span class="hljs-params">()</span></span>{
  <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, len = <span class="hljs-keyword">this</span>._toCall.length;
  <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>._recomputeTimeout;
  <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;len;i++){
    <span class="hljs-keyword">this</span>._toCall.shift().call();
  }
  <span class="hljs-keyword">this</span>._toCall.added = {};
}

<span class="hljs-keyword">var</span> ComputedProperty = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(prop, options)</span></span>{

  <span class="hljs-keyword">if</span>(!_.isFunction(prop)) <span class="hljs-keyword">return</span> <span class="hljs-built_in">console</span>.error(<span class="hljs-string">'ComputedProperty constructor must be passed a function!'</span>, prop, <span class="hljs-string">'Found instead.'</span>);
  options = options || {};
  <span class="hljs-keyword">this</span>.cid = _.uniqueId(<span class="hljs-string">'computedPropety'</span>);
  <span class="hljs-keyword">this</span>.name = options.name;
  <span class="hljs-keyword">this</span>.returnType = <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">this</span>.__observers = {};
  <span class="hljs-keyword">this</span>.helpers = {};
  <span class="hljs-keyword">this</span>.waiting = {};
  <span class="hljs-keyword">this</span>.isChanging = <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">this</span>.isDirty = <span class="hljs-literal">true</span>;
  <span class="hljs-keyword">this</span>.func = prop;
  _.bindAll(<span class="hljs-keyword">this</span>, <span class="hljs-string">'onModify'</span>, <span class="hljs-string">'markDirty'</span>);
  <span class="hljs-keyword">this</span>.deps = propertyCompiler.compile(prop, <span class="hljs-keyword">this</span>.name);</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>Create lineage to pass to our cache objects</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> lineage = {
    parent: <span class="hljs-keyword">this</span>.setParent( options.parent || <span class="hljs-keyword">this</span> ),
    root: <span class="hljs-keyword">this</span>.setRoot( options.root || options.parent || <span class="hljs-keyword">this</span> ),
    path: <span class="hljs-keyword">this</span>.__path = options.path || <span class="hljs-keyword">this</span>.__path
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>Results Cache Objects
These models will never be re-created for the lifetime of the Computed Proeprty
On Recompute they are updated with new values.
On Change their new values are pushed to the object it is tracking</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">this</span>.cache = {
    model: <span class="hljs-keyword">new</span> Rebound.Model({}, lineage),
    collection: <span class="hljs-keyword">new</span> Rebound.Collection([], lineage),
    value: <span class="hljs-literal">undefined</span>
  };

  <span class="hljs-keyword">this</span>.wire();

};

_.extend(ComputedProperty.prototype, Backbone.Events, {

  isComputedProperty: <span class="hljs-literal">true</span>,
  isData: <span class="hljs-literal">true</span>,
  __path: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{ <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>; },


  markDirty: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.isDirty) <span class="hljs-keyword">return</span>;
    <span class="hljs-keyword">this</span>.isDirty = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>.trigger(<span class="hljs-string">'dirty'</span>, <span class="hljs-keyword">this</span>);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p>Attached to listen to all events where this Computed Property’s dependancies
are stored. See wire(). Will re-evaluate any computed properties that
depend on the changed data value which triggered this callback.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  onRecompute: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(type, model, collection, options)</span></span>{
    <span class="hljs-keyword">var</span> shortcircuit = { change: <span class="hljs-number">1</span>, sort: <span class="hljs-number">1</span>, request: <span class="hljs-number">1</span>, destroy: <span class="hljs-number">1</span>, sync: <span class="hljs-number">1</span>, error: <span class="hljs-number">1</span>, invalid: <span class="hljs-number">1</span>, route: <span class="hljs-number">1</span>, dirty: <span class="hljs-number">1</span> };
    <span class="hljs-keyword">if</span>( shortcircuit[type] || !model.isData ) <span class="hljs-keyword">return</span>;
    model || (model = {});
    collection || (collection = {});
    options || (options = {});
    <span class="hljs-keyword">this</span>._toCall || (<span class="hljs-keyword">this</span>._toCall = []);
    <span class="hljs-keyword">this</span>._toCall.added || (<span class="hljs-keyword">this</span>._toCall.added = {});
    !collection.isData &amp;&amp; (options = collection) &amp;&amp; (collection = model);
    <span class="hljs-keyword">var</span> push = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(arr)</span></span>{
      <span class="hljs-keyword">var</span> i, len = arr.length;
      <span class="hljs-keyword">this</span>.added || (<span class="hljs-keyword">this</span>.added = {});
      <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;len;i++){
        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.added[arr[i].cid]) <span class="hljs-keyword">continue</span>;
        <span class="hljs-keyword">this</span>.added[arr[i].cid] = <span class="hljs-number">1</span>;
        <span class="hljs-keyword">this</span>.push(arr[i]);
      }
    }, path, vector;
    vector = path = collection.__path().replace(<span class="hljs-regexp">/\.?\[.*\]/ig</span>, <span class="hljs-string">'.@each'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <p>If a reset event on a Model, check for computed properties that depend
on each changed attribute’s full path.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span>(type === <span class="hljs-string">'reset'</span> &amp;&amp; options.previousAttributes){
      _.each(options.previousAttributes, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(value, key)</span></span>{
        vector = path + (path &amp;&amp; <span class="hljs-string">'.'</span>) + key;
        _.each(<span class="hljs-keyword">this</span>.__computedDeps, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(dependants, dependancy)</span></span>{
          startsWith(vector, dependancy) &amp;&amp; push.call(<span class="hljs-keyword">this</span>._toCall, dependants);
        }, <span class="hljs-keyword">this</span>);
      }, <span class="hljs-keyword">this</span>);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <p>If a reset event on a Collction, check for computed properties that depend
on anything inside that collection.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(type === <span class="hljs-string">'reset'</span> &amp;&amp; options.previousModels){
      _.each(<span class="hljs-keyword">this</span>.__computedDeps, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(dependants, dependancy)</span></span>{
        startsWith(dependancy, vector) &amp;&amp; push.call(<span class="hljs-keyword">this</span>._toCall, dependants);
      }, <span class="hljs-keyword">this</span>);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <p>If an add or remove event, check for computed properties that depend on
anything inside that collection or that contains that collection.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(type === <span class="hljs-string">'add'</span> || type === <span class="hljs-string">'remove'</span>){
      _.each(<span class="hljs-keyword">this</span>.__computedDeps, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(dependants, dependancy)</span></span>{
        <span class="hljs-keyword">if</span>( startsWith(dependancy, vector) || startsWith(vector, dependancy) ) push.call(<span class="hljs-keyword">this</span>._toCall, dependants);;
      }, <span class="hljs-keyword">this</span>);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <p>If a change event, trigger anything that depends on that changed path.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(type.indexOf(<span class="hljs-string">'change:'</span>) === <span class="hljs-number">0</span>){
      vector = type.replace(<span class="hljs-string">'change:'</span>, <span class="hljs-string">''</span>).replace(<span class="hljs-regexp">/\.?\[.*\]/ig</span>, <span class="hljs-string">'.@each'</span>);
      _.each(<span class="hljs-keyword">this</span>.__computedDeps, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(dependants, dependancy)</span></span>{
        startsWith(vector, dependancy) &amp;&amp; push.call(<span class="hljs-keyword">this</span>._toCall, dependants);
      }, <span class="hljs-keyword">this</span>);
    }

    <span class="hljs-keyword">var</span> i, len = <span class="hljs-keyword">this</span>._toCall.length;
    <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;len;i++){
      <span class="hljs-keyword">this</span>._toCall[i].markDirty();
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <p>Notifies all computed properties in the dependants array to recompute.
Marks everyone as dirty and then calls them.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">this</span>._recomputeTimeout) <span class="hljs-keyword">this</span>._recomputeTimeout = setTimeout(_.bind(recomputeCallback, <span class="hljs-keyword">this</span>), <span class="hljs-number">0</span>);
    <span class="hljs-keyword">return</span>;
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              <p>Called when a Computed Property’s active cache object changes.
Pushes any changes to Computed Property that returns a data object back to
the original object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  onModify: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(type, model, collection, options)</span></span>{
    <span class="hljs-keyword">var</span> shortcircuit = { sort: <span class="hljs-number">1</span>, request: <span class="hljs-number">1</span>, destroy: <span class="hljs-number">1</span>, sync: <span class="hljs-number">1</span>, error: <span class="hljs-number">1</span>, invalid: <span class="hljs-number">1</span>, route: <span class="hljs-number">1</span> };
    <span class="hljs-keyword">if</span>( !<span class="hljs-keyword">this</span>.tracking || shortcircuit[type] || ~type.indexOf(<span class="hljs-string">'change:'</span>) ) <span class="hljs-keyword">return</span>;
    model || (model = {});
    collection || (collection = {});
    options || (options = {});
    !collection.isData &amp;&amp; _.isObject(collection) &amp;&amp; (options = collection) &amp;&amp; (collection = model);
    <span class="hljs-keyword">var</span> src = <span class="hljs-keyword">this</span>;
    <span class="hljs-keyword">var</span> path = collection.__path().replace(src.__path(), <span class="hljs-string">''</span>).replace(<span class="hljs-regexp">/^\./</span>, <span class="hljs-string">''</span>);
    <span class="hljs-keyword">var</span> dest = <span class="hljs-keyword">this</span>.tracking.get(path);

    <span class="hljs-keyword">if</span>(_.isUndefined(dest)) <span class="hljs-keyword">return</span>;
    <span class="hljs-keyword">if</span>(type === <span class="hljs-string">'change'</span>) dest.set &amp;&amp; dest.set(model.changedAttributes());
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(type === <span class="hljs-string">'reset'</span>) dest.reset &amp;&amp; dest.reset(model);
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(type === <span class="hljs-string">'add'</span>)  dest.add &amp;&amp; dest.add(model);
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(type === <span class="hljs-string">'remove'</span>)  dest.remove &amp;&amp; dest.remove(model);</pre></div></div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-79">&#182;</a>
              </div>
              <p>TODO: Add sort</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  },</pre></div></div>
            
        </li>
        
        
        <li id="section-80">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-80">&#182;</a>
              </div>
              <p>Adds a litener to the root object and tells it what properties this
Computed Property depend on.
The listener will re-compute this Computed Property when any are changed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  wire: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    <span class="hljs-keyword">var</span> root = <span class="hljs-keyword">this</span>.__root__;
    <span class="hljs-keyword">var</span> context = <span class="hljs-keyword">this</span>.__parent__;
    root.__computedDeps || (root.__computedDeps = {});

    _.each(<span class="hljs-keyword">this</span>.deps, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(path)</span></span>{
      <span class="hljs-keyword">var</span> dep = root.get(path, {raw: <span class="hljs-literal">true</span>});
      <span class="hljs-keyword">if</span>(!dep || !dep.isComputedProperty) <span class="hljs-keyword">return</span>;
      dep.on(<span class="hljs-string">'dirty'</span>, <span class="hljs-keyword">this</span>.markDirty);
    }, <span class="hljs-keyword">this</span>);

    _.each(<span class="hljs-keyword">this</span>.deps, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(path)</span></span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-81">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-81">&#182;</a>
              </div>
              <p>Find actual path from relative paths</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> split = $.splitPath(path);
      <span class="hljs-keyword">while</span>(split[<span class="hljs-number">0</span>] === <span class="hljs-string">'@parent'</span>){
        context = context.__parent__;
        split.shift();
      }

      path = context.__path().replace(<span class="hljs-regexp">/\.?\[.*\]/ig</span>, <span class="hljs-string">'.@each'</span>);
      path = path + (path &amp;&amp; <span class="hljs-string">'.'</span>) + split.join(<span class="hljs-string">'.'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-82">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-82">&#182;</a>
              </div>
              <p>Add ourselves as dependants</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      root.__computedDeps[path] || (root.__computedDeps[path] = []);
      root.__computedDeps[path].push(<span class="hljs-keyword">this</span>);
    }, <span class="hljs-keyword">this</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-83">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-83">&#182;</a>
              </div>
              <p>Ensure we only have one listener per Model at a time.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    context.off(<span class="hljs-string">'all'</span>, <span class="hljs-keyword">this</span>.onRecompute).on(<span class="hljs-string">'all'</span>, <span class="hljs-keyword">this</span>.onRecompute);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-84">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-84">&#182;</a>
              </div>
              <p>Call this computed property like you would with Function.call()</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  call: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    <span class="hljs-keyword">var</span> args = <span class="hljs-built_in">Array</span>.prototype.slice.call(<span class="hljs-built_in">arguments</span>),
        context = args.shift();
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.apply(context, args);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-85">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-85">&#182;</a>
              </div>
              <p>Call this computed property like you would with Function.apply()
Only properties that are marked as dirty and are not already computing
themselves are evaluated to prevent cyclic callbacks. If any dependants
aren’t finished computeding, we add ourselved to their waiting list.
Vanilla objects returned from the function are promoted to Rebound Objects.
Then, set the proper return type for future fetches from the cache and set
the new computed value. Track changes to the cache to push it back up to
the original object and return the value.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  apply: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(context, params)</span></span>{

    <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">this</span>.isDirty || <span class="hljs-keyword">this</span>.isChanging) <span class="hljs-keyword">return</span>;
    <span class="hljs-keyword">this</span>.isChanging = <span class="hljs-literal">true</span>;

    <span class="hljs-keyword">var</span> value = <span class="hljs-keyword">this</span>.cache[<span class="hljs-keyword">this</span>.returnType],
        result;

    context || (context = <span class="hljs-keyword">this</span>.__parent__);</pre></div></div>
            
        </li>
        
        
        <li id="section-86">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-86">&#182;</a>
              </div>
              <p>Check all of our dependancies to see if they are evaluating.
If we have a dependancy that is dirty and this isnt its first run,
Let this dependancy know that we are waiting for it.
It will re-run this Computed Property after it finishes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _.each(<span class="hljs-keyword">this</span>.deps, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(dep)</span></span>{
      <span class="hljs-keyword">var</span> dependancy = context.get(dep, {raw: <span class="hljs-literal">true</span>});
      <span class="hljs-keyword">if</span>(!dependancy || !dependancy.isComputedProperty) <span class="hljs-keyword">return</span>;
      <span class="hljs-keyword">if</span>(dependancy.isDirty &amp;&amp; dependancy.returnType !== <span class="hljs-literal">null</span>){
        dependancy.waiting[<span class="hljs-keyword">this</span>.cid] = <span class="hljs-keyword">this</span>;
        dependancy.apply(); <span class="hljs-comment">// Try to re-evaluate this dependancy if it is dirty</span>
        <span class="hljs-keyword">if</span>(dependancy.isDirty) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.isChanging = <span class="hljs-literal">false</span>;
      }
      <span class="hljs-keyword">delete</span> dependancy.waiting[<span class="hljs-keyword">this</span>.cid];</pre></div></div>
            
        </li>
        
        
        <li id="section-87">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-87">&#182;</a>
              </div>
              <p>TODO: There can be a check here looking for cyclic dependancies.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    }, <span class="hljs-keyword">this</span>);

    <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">this</span>.isChanging) <span class="hljs-keyword">return</span>;

    <span class="hljs-keyword">this</span>.stopListening(value, <span class="hljs-string">'all'</span>, <span class="hljs-keyword">this</span>.onModify);

    result = <span class="hljs-keyword">this</span>.func.apply(context, params);</pre></div></div>
            
        </li>
        
        
        <li id="section-88">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-88">&#182;</a>
              </div>
              <p>Promote vanilla objects to Rebound Data keeping the same original objects</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span>(_.isArray(result)) result = <span class="hljs-keyword">new</span> Rebound.Collection(result, {clone: <span class="hljs-literal">false</span>});
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(_.isObject(result) &amp;&amp; !result.isData) result = <span class="hljs-keyword">new</span> Rebound.Model(result, {clone: <span class="hljs-literal">false</span>});</pre></div></div>
            
        </li>
        
        
        <li id="section-89">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-89">&#182;</a>
              </div>
              <p>If result is undefined, reset our cache item</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span>(_.isUndefined(result) || _.isNull(result)){
      <span class="hljs-keyword">this</span>.returnType = <span class="hljs-string">'value'</span>;
      <span class="hljs-keyword">this</span>.isCollection = <span class="hljs-keyword">this</span>.isModel = <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">this</span>.set(<span class="hljs-literal">undefined</span>);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-90">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-90">&#182;</a>
              </div>
              <p>Set result and return types, bind events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(result.isCollection){
      <span class="hljs-keyword">this</span>.returnType = <span class="hljs-string">'collection'</span>;
      <span class="hljs-keyword">this</span>.isCollection = <span class="hljs-literal">true</span>;
      <span class="hljs-keyword">this</span>.isModel = <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">this</span>.set(result);
      <span class="hljs-keyword">this</span>.track(result);
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(result.isModel){
      <span class="hljs-keyword">this</span>.returnType = <span class="hljs-string">'model'</span>;
      <span class="hljs-keyword">this</span>.isCollection = <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">this</span>.isModel = <span class="hljs-literal">true</span>;
      <span class="hljs-keyword">this</span>.reset(result);
      <span class="hljs-keyword">this</span>.track(result);
    }
    <span class="hljs-keyword">else</span>{
      <span class="hljs-keyword">this</span>.returnType = <span class="hljs-string">'value'</span>;
      <span class="hljs-keyword">this</span>.isCollection = <span class="hljs-keyword">this</span>.isModel = <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">this</span>.reset(result);
    }

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.value();
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-91">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-91">&#182;</a>
              </div>
              <p>When we receive a new model to set in our cache, unbind the tracker from
the previous cache object, sync the objects’ cids so helpers think they
are the same object, save a referance to the object we are tracking,
and re-bind our onModify hook.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  track: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(object)</span></span>{
    <span class="hljs-keyword">var</span> target = <span class="hljs-keyword">this</span>.value();
    <span class="hljs-keyword">if</span>(!object || !target || !target.isData || !object.isData) <span class="hljs-keyword">return</span>;
    target._cid || (target._cid = target.cid);
    object._cid || (object._cid = object.cid);
    target.cid = object.cid;
    <span class="hljs-keyword">this</span>.tracking = object;
    <span class="hljs-keyword">this</span>.listenTo(target, <span class="hljs-string">'all'</span>, <span class="hljs-keyword">this</span>.onModify);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-92">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-92">&#182;</a>
              </div>
              <p>Get from the Computed Property’s cache</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  get: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(key, options)</span></span>{
    <span class="hljs-keyword">var</span> value = <span class="hljs-keyword">this</span>.value();
    options || (options = {});
    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.returnType === <span class="hljs-string">'value'</span>) <span class="hljs-keyword">return</span> <span class="hljs-built_in">console</span>.error(<span class="hljs-string">'Called get on the `'</span>+ <span class="hljs-keyword">this</span>.name +<span class="hljs-string">'` computed property which returns a primitive value.'</span>);
    <span class="hljs-keyword">return</span> value.get(key, options);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-93">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-93">&#182;</a>
              </div>
              <p>Set the Computed Property’s cache to a new value and trigger appropreate events.
Changes will propagate back to the original object if a Rebound Data Object and re-compute.
If Computed Property returns a value, all downstream dependancies will re-compute.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  set: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(key, val, options)</span></span>{
    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.returnType === <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;
    options || (options = {});
    <span class="hljs-keyword">var</span> attrs = key;
    <span class="hljs-keyword">var</span> value = <span class="hljs-keyword">this</span>.value();
    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.returnType === <span class="hljs-string">'model'</span>){
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> key === <span class="hljs-string">'object'</span>) {
        attrs = (key.isModel) ? key.attributes : key;
        options = val;
      } <span class="hljs-keyword">else</span> {
        (attrs = {})[key] = val;
      }
    }
    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.returnType !== <span class="hljs-string">'model'</span>) options = val || {};
    attrs = (attrs &amp;&amp; attrs.isComputedProperty) ? attrs.value() : attrs;</pre></div></div>
            
        </li>
        
        
        <li id="section-94">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-94">&#182;</a>
              </div>
              <p>If a new value, set it and trigger events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.returnType === <span class="hljs-string">'value'</span> &amp;&amp; <span class="hljs-keyword">this</span>.cache.value !== attrs){
      <span class="hljs-keyword">this</span>.cache.value = attrs;
      <span class="hljs-keyword">if</span>(!options.quiet){</pre></div></div>
            
        </li>
        
        
        <li id="section-95">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-95">&#182;</a>
              </div>
              <p>If set was called not through computedProperty.call(), this is a fresh new event burst.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">this</span>.isDirty &amp;&amp; !<span class="hljs-keyword">this</span>.isChanging) <span class="hljs-keyword">this</span>.__parent__.changed = {};
        <span class="hljs-keyword">this</span>.__parent__.changed[<span class="hljs-keyword">this</span>.name] = attrs;
        <span class="hljs-keyword">this</span>.trigger(<span class="hljs-string">'change'</span>, <span class="hljs-keyword">this</span>.__parent__);
        <span class="hljs-keyword">this</span>.trigger(<span class="hljs-string">'change:'</span>+<span class="hljs-keyword">this</span>.name, <span class="hljs-keyword">this</span>.__parent__, attrs);
        <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>.__parent__.changed[<span class="hljs-keyword">this</span>.name];
      }
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.returnType !== <span class="hljs-string">'value'</span> &amp;&amp; options.reset) key = value.reset(attrs, options);
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.returnType !== <span class="hljs-string">'value'</span>) key = value.set(attrs, options);
    <span class="hljs-keyword">this</span>.isDirty = <span class="hljs-keyword">this</span>.isChanging = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-96">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-96">&#182;</a>
              </div>
              <p>Call all reamining computed properties waiting for this value to resolve.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _.each(<span class="hljs-keyword">this</span>.waiting, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(prop)</span></span>{ prop &amp;&amp; prop.call(); });

    <span class="hljs-keyword">return</span> key;
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-97">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-97">&#182;</a>
              </div>
              <p>Return the current value from the cache, running if dirty.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  value: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.isDirty) <span class="hljs-keyword">this</span>.apply();
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.cache[<span class="hljs-keyword">this</span>.returnType];
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-98">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-98">&#182;</a>
              </div>
              <p>Reset the current value in the cache, running if first run.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  reset: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(obj, options)</span></span>{
    <span class="hljs-keyword">if</span>(_.isNull(<span class="hljs-keyword">this</span>.returnType)) <span class="hljs-keyword">return</span>; <span class="hljs-comment">// First run</span>
    options || (options = {});
    options.reset = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">return</span>  <span class="hljs-keyword">this</span>.set(obj, options);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-99">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-99">&#182;</a>
              </div>
              <p>Cyclic dependancy safe toJSON method.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  toJSON: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._isSerializing) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.cid;
    <span class="hljs-keyword">var</span> val = <span class="hljs-keyword">this</span>.value();
    <span class="hljs-keyword">this</span>._isSerializing = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">var</span> json = (val &amp;&amp; _.isFunction(val.toJSON)) ? val.toJSON() : val;
    <span class="hljs-keyword">this</span>._isSerializing = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">return</span> json;
  }

});

export <span class="hljs-keyword">default</span> ComputedProperty;</pre></div></div>
            
        </li>
        
        
        <li id="section-100">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-100">&#182;</a>
              </div>
              <h2 id="rebound-component">Rebound Component</h2>

            </div>
            
        </li>
        
        
        <li id="section-101">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-101">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
import DOMHelper from <span class="hljs-string">"dom-helper"</span>;
import hooks from <span class="hljs-string">"rebound-component/hooks"</span>;
import helpers from <span class="hljs-string">"rebound-component/helpers"</span>;
import $ from <span class="hljs-string">"rebound-component/utils"</span>;
import { Model } from <span class="hljs-string">"rebound-data/rebound-data"</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-102">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-102">&#182;</a>
              </div>
              <p>If Backbone hasn’t been started yet, throw error</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">if</span>(!<span class="hljs-built_in">window</span>.Backbone) <span class="hljs-keyword">throw</span> <span class="hljs-string">"Backbone must be on the page for Rebound to load."</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-103">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-103">&#182;</a>
              </div>
              <p>Returns true if <code>str</code> starts with <code>test</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">startsWith</span><span class="hljs-params">(str, test)</span></span>{
  <span class="hljs-keyword">if</span>(str === test) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  <span class="hljs-keyword">return</span> str.substring(<span class="hljs-number">0</span>, test.length+<span class="hljs-number">1</span>) === test+<span class="hljs-string">'.'</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">renderCallback</span><span class="hljs-params">()</span></span>{
  <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, len = <span class="hljs-keyword">this</span>._toRender.length;
  <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>._renderTimeout;
  <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;len;i++){
    <span class="hljs-keyword">this</span>._toRender.shift().notify();
  }
  <span class="hljs-keyword">this</span>._toRender.added = {};
}

<span class="hljs-keyword">var</span> env = {
  helpers: helpers.helpers,
  hooks: hooks
};

env.hydrate = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hydrate</span><span class="hljs-params">(spec, options)</span></span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-104">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-104">&#182;</a>
              </div>
              <p>Return a wrapper function that will merge user provided helpers and hooks with our defaults</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data, options)</span></span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-105">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-105">&#182;</a>
              </div>
              <p>Ensure we have a well-formed object as var options</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> env = options || {},
        contextElement = data.el || <span class="hljs-built_in">document</span>.body;
    env.helpers = env.helpers || {};
    env.hooks = env.hooks || {};
    env.dom = env.dom || <span class="hljs-keyword">new</span> DOMHelper();</pre></div></div>
            
        </li>
        
        
        <li id="section-106">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-106">&#182;</a>
              </div>
              <p>Merge our default helpers and hooks with user provided helpers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    env.helpers = _.defaults(env.helpers, helpers.helpers);
    env.hooks = _.defaults(env.hooks, hooks);</pre></div></div>
            
        </li>
        
        
        <li id="section-107">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-107">&#182;</a>
              </div>
              <p>Call our func with merged helpers and hooks</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">return</span> spec.render(data, env, contextElement);
  };
};</pre></div></div>
            
        </li>
        
        
        <li id="section-108">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-108">&#182;</a>
              </div>
              <p>New Backbone Component</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> Component = Model.extend({

  isComponent: <span class="hljs-literal">true</span>,

  constructor: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(options)</span></span>{
    options = options || (options = {});
    _.bindAll(<span class="hljs-keyword">this</span>, <span class="hljs-string">'__callOnComponent'</span>);
    <span class="hljs-keyword">this</span>.cid = _.uniqueId(<span class="hljs-string">'component'</span>);
    <span class="hljs-keyword">this</span>.attributes = {};
    <span class="hljs-keyword">this</span>.changed = {};
    <span class="hljs-keyword">this</span>.helpers = {};
    <span class="hljs-keyword">this</span>.__parent__ = <span class="hljs-keyword">this</span>.__root__ = <span class="hljs-keyword">this</span>;
    <span class="hljs-keyword">this</span>.listenTo(<span class="hljs-keyword">this</span>, <span class="hljs-string">'all'</span>, <span class="hljs-keyword">this</span>._onChange);</pre></div></div>
            
        </li>
        
        
        <li id="section-109">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-109">&#182;</a>
              </div>
              <p>Take our parsed data and add it to our backbone data structure. Does a deep defaults set.
In the model, primatives (arrays, objects, etc) are converted to Backbone Objects
Functions are compiled to find their dependancies and added as computed properties
Set our component’s context with the passed data merged with the component’s defaults</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.set((<span class="hljs-keyword">this</span>.defaults || {}), {defaults: <span class="hljs-literal">true</span>});
    <span class="hljs-keyword">this</span>.set((options.data || {}));</pre></div></div>
            
        </li>
        
        
        <li id="section-110">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-110">&#182;</a>
              </div>
              <p>Call on component is used by the {{on}} helper to call all event callbacks in the scope of the component</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.helpers.__callOnComponent = <span class="hljs-keyword">this</span>.__callOnComponent;</pre></div></div>
            
        </li>
        
        
        <li id="section-111">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-111">&#182;</a>
              </div>
              <p>Get any additional routes passed in from options</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.routes =  _.defaults((options.routes || {}), <span class="hljs-keyword">this</span>.routes);</pre></div></div>
            
        </li>
        
        
        <li id="section-112">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-112">&#182;</a>
              </div>
              <p>Ensure that all route functions exist</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _.each(<span class="hljs-keyword">this</span>.routes, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(value, key, routes)</span></span>{
        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> value !== <span class="hljs-string">'string'</span>){ <span class="hljs-keyword">throw</span>(<span class="hljs-string">'Function name passed to routes in  '</span> + <span class="hljs-keyword">this</span>.__name + <span class="hljs-string">' component must be a string!'</span>); }
        <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">this</span>[value]){ <span class="hljs-keyword">throw</span>(<span class="hljs-string">'Callback function '</span>+value+<span class="hljs-string">' does not exist on the  '</span> + <span class="hljs-keyword">this</span>.__name + <span class="hljs-string">' component!'</span>); }
    }, <span class="hljs-keyword">this</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-113">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-113">&#182;</a>
              </div>
              <p>Set our outlet and template if we have one</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.el = options.outlet || <span class="hljs-literal">undefined</span>;
    <span class="hljs-keyword">this</span>.$el = (_.isUndefined(<span class="hljs-built_in">window</span>.Backbone.$)) ? <span class="hljs-literal">false</span> : <span class="hljs-built_in">window</span>.Backbone.$(<span class="hljs-keyword">this</span>.el);

    <span class="hljs-keyword">if</span>(_.isFunction(<span class="hljs-keyword">this</span>.createdCallback)){
      <span class="hljs-keyword">this</span>.createdCallback.call(<span class="hljs-keyword">this</span>);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-114">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-114">&#182;</a>
              </div>
              <p>Take our precompiled template and hydrates it. When Rebound Compiler is included, can be a handlebars template string.
TODO: Check if template is a string, and if the compiler exists on the page, and compile if needed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span>(!options.template &amp;&amp; !<span class="hljs-keyword">this</span>.template){ <span class="hljs-keyword">throw</span>(<span class="hljs-string">'Template must provided for '</span> + <span class="hljs-keyword">this</span>.__name + <span class="hljs-string">' component!'</span>); }
    <span class="hljs-keyword">this</span>.template = options.template || <span class="hljs-keyword">this</span>.template;
    <span class="hljs-keyword">this</span>.template = (<span class="hljs-keyword">typeof</span> <span class="hljs-keyword">this</span>.template === <span class="hljs-string">'object'</span>) ? env.hydrate(<span class="hljs-keyword">this</span>.template) : <span class="hljs-keyword">this</span>.template;</pre></div></div>
            
        </li>
        
        
        <li id="section-115">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-115">&#182;</a>
              </div>
              <p>Render our dom and place the dom in our custom element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">this</span>.el.appendChild(<span class="hljs-keyword">this</span>.template(<span class="hljs-keyword">this</span>, {helpers: <span class="hljs-keyword">this</span>.helpers}, <span class="hljs-keyword">this</span>.el));

    <span class="hljs-keyword">this</span>.initialize();

  },

  $: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(selector)</span> </span>{
    <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">this</span>.$el){
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">console</span>.error(<span class="hljs-string">'No DOM manipulation library on the page!'</span>);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.$el.find(selector);
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-116">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-116">&#182;</a>
              </div>
              <p>Trigger all events on both the component and the element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  trigger: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(eventName)</span></span>{
    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.el){
      $(<span class="hljs-keyword">this</span>.el).trigger(eventName, <span class="hljs-built_in">arguments</span>);
    }
    Backbone.Model.prototype.trigger.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
  },

  __callOnComponent: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name, event)</span></span>{
    <span class="hljs-keyword">if</span>(!_.isFunction(<span class="hljs-keyword">this</span>[name])){ <span class="hljs-keyword">throw</span> <span class="hljs-string">"ERROR: No method named "</span> + name + <span class="hljs-string">" on component "</span> + <span class="hljs-keyword">this</span>.__name + <span class="hljs-string">"!"</span>; }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>[name].call(<span class="hljs-keyword">this</span>, event);
  },

  _onAttributeChange: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(attrName, oldVal, newVal)</span></span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-117">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-117">&#182;</a>
              </div>
              <p>Commented out because tracking attribute changes and making sure they dont infinite loop is hard.
TODO: Make work.
try{ newVal = JSON.parse(newVal); } catch (e){ newVal = newVal; }</p>
<p>// data attributes should be referanced by their camel case name
attrName = attrName.replace(/^data-/g, “”).replace(/-([a-z])/g, function (g) { return g[1].toUpperCase(); });</p>
<p>oldVal = this.get(attrName);</p>
<p>if(newVal === null){ this.unset(attrName); }</p>
<p>// If oldVal is a number, and newVal is only numerical, preserve type
if(<em>.isNumber(oldVal) &amp;&amp; </em>.isString(newVal) &amp;&amp; newVal.match(/^[0-9]*$/i)){
  newVal = parseInt(newVal);
}</p>
<p>else{ this.set(attrName, newVal, {quiet: true}); }</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  },


  _onChange: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(type, model, collection, options)</span></span>{
    <span class="hljs-keyword">var</span> shortcircuit = { change: <span class="hljs-number">1</span>, sort: <span class="hljs-number">1</span>, request: <span class="hljs-number">1</span>, destroy: <span class="hljs-number">1</span>, sync: <span class="hljs-number">1</span>, error: <span class="hljs-number">1</span>, invalid: <span class="hljs-number">1</span>, route: <span class="hljs-number">1</span>, dirty: <span class="hljs-number">1</span> };
    <span class="hljs-keyword">if</span>( shortcircuit[type] ) <span class="hljs-keyword">return</span>;

    <span class="hljs-keyword">var</span> data, changed;
    model || (model = {});
    collection || (collection = {});
    options || (options = {});
    !collection.isData &amp;&amp; (options = collection) &amp;&amp; (collection = model);
    <span class="hljs-keyword">this</span>._toRender || (<span class="hljs-keyword">this</span>._toRender = []);

    <span class="hljs-keyword">if</span>( (type === <span class="hljs-string">'reset'</span> &amp;&amp; options.previousAttributes) || type.indexOf(<span class="hljs-string">'change:'</span>) !== -<span class="hljs-number">1</span>){
      data = model;
      changed = model.changedAttributes();
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(type === <span class="hljs-string">'add'</span> || type === <span class="hljs-string">'remove'</span> || (type === <span class="hljs-string">'reset'</span> &amp;&amp; options.previousModels)){
      data = collection;
      changed = {};
      changed[data.__path()] = data;
    }

    <span class="hljs-keyword">if</span>(!data || !changed) <span class="hljs-keyword">return</span>;

    <span class="hljs-keyword">var</span> push = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(arr)</span></span>{
      <span class="hljs-keyword">var</span> i, len = arr.length;
      <span class="hljs-keyword">this</span>.added || (<span class="hljs-keyword">this</span>.added = {});
      <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;len;i++){
        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.added[arr[i].cid]) <span class="hljs-keyword">continue</span>;
        <span class="hljs-keyword">this</span>.added[arr[i].cid] = <span class="hljs-number">1</span>;
        <span class="hljs-keyword">this</span>.push(arr[i]);
      }
    };
    <span class="hljs-keyword">var</span> context = <span class="hljs-keyword">this</span>;
    <span class="hljs-keyword">var</span> basePath = data.__path();
    <span class="hljs-keyword">var</span> parts = $.splitPath(basePath);
    <span class="hljs-keyword">var</span> key, obsPath, path, observers;</pre></div></div>
            
        </li>
        
        
        <li id="section-118">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-118">&#182;</a>
              </div>
              <p>For each changed key, walk down the data tree from the root to the data
element that triggered the event and add all relevent callbacks to this
object’s _toRender queue.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">do</span>{
      <span class="hljs-keyword">for</span>(key <span class="hljs-keyword">in</span> changed){
        path = (basePath + (basePath &amp;&amp; <span class="hljs-string">'.'</span>) + key).replace(context.__path(), <span class="hljs-string">''</span>).replace(<span class="hljs-regexp">/\[[^\]]+\]/g</span>, <span class="hljs-string">".@each"</span>).replace(<span class="hljs-regexp">/^\./</span>, <span class="hljs-string">''</span>);
        <span class="hljs-keyword">for</span>(obsPath <span class="hljs-keyword">in</span> context.__observers){
          observers = context.__observers[obsPath];
          <span class="hljs-keyword">if</span>(startsWith(obsPath, path) || startsWith(path, obsPath)){</pre></div></div>
            
        </li>
        
        
        <li id="section-119">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-119">&#182;</a>
              </div>
              <p>If this is a collection event, trigger everything, otherwise only trigger property change callbacks</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span>(data.isCollection) push.call(<span class="hljs-keyword">this</span>._toRender, observers.collection);
            push.call(<span class="hljs-keyword">this</span>._toRender, observers.model);
          }
        }
      }
    } <span class="hljs-keyword">while</span>(context !== data &amp;&amp; (context = context.get(parts.shift())))</pre></div></div>
            
        </li>
        
        
        <li id="section-120">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-120">&#182;</a>
              </div>
              <p>Queue our render callback to be called after the current call stack has been exhausted</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-built_in">window</span>.clearTimeout(<span class="hljs-keyword">this</span>._renderTimeout);
    <span class="hljs-keyword">this</span>._renderTimeout = <span class="hljs-built_in">window</span>.setTimeout(_.bind(renderCallback, <span class="hljs-keyword">this</span>), <span class="hljs-number">0</span>);
  }

});

Component.extend= <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(protoProps, staticProps)</span> </span>{
  <span class="hljs-keyword">var</span> parent = <span class="hljs-keyword">this</span>,
      child,
      reservedMethods = {
        <span class="hljs-string">'trigger'</span>:<span class="hljs-number">1</span>,    <span class="hljs-string">'constructor'</span>:<span class="hljs-number">1</span>, <span class="hljs-string">'get'</span>:<span class="hljs-number">1</span>,               <span class="hljs-string">'set'</span>:<span class="hljs-number">1</span>,             <span class="hljs-string">'has'</span>:<span class="hljs-number">1</span>,
        <span class="hljs-string">'extend'</span>:<span class="hljs-number">1</span>,     <span class="hljs-string">'escape'</span>:<span class="hljs-number">1</span>,      <span class="hljs-string">'unset'</span>:<span class="hljs-number">1</span>,             <span class="hljs-string">'clear'</span>:<span class="hljs-number">1</span>,           <span class="hljs-string">'cid'</span>:<span class="hljs-number">1</span>,
        <span class="hljs-string">'attributes'</span>:<span class="hljs-number">1</span>, <span class="hljs-string">'changed'</span>:<span class="hljs-number">1</span>,     <span class="hljs-string">'toJSON'</span>:<span class="hljs-number">1</span>,            <span class="hljs-string">'validationError'</span>:<span class="hljs-number">1</span>, <span class="hljs-string">'isValid'</span>:<span class="hljs-number">1</span>,
        <span class="hljs-string">'isNew'</span>:<span class="hljs-number">1</span>,      <span class="hljs-string">'hasChanged'</span>:<span class="hljs-number">1</span>,  <span class="hljs-string">'changedAttributes'</span>:<span class="hljs-number">1</span>, <span class="hljs-string">'previous'</span>:<span class="hljs-number">1</span>,        <span class="hljs-string">'previousAttributes'</span>:<span class="hljs-number">1</span>
      },
      configProperties = {
        <span class="hljs-string">'routes'</span>:<span class="hljs-number">1</span>,     <span class="hljs-string">'template'</span>:<span class="hljs-number">1</span>,    <span class="hljs-string">'defaults'</span>:<span class="hljs-number">1</span>, <span class="hljs-string">'outlet'</span>:<span class="hljs-number">1</span>,          <span class="hljs-string">'url'</span>:<span class="hljs-number">1</span>,
        <span class="hljs-string">'urlRoot'</span>:<span class="hljs-number">1</span>,    <span class="hljs-string">'idAttribute'</span>:<span class="hljs-number">1</span>, <span class="hljs-string">'id'</span>:<span class="hljs-number">1</span>,       <span class="hljs-string">'createdCallback'</span>:<span class="hljs-number">1</span>, <span class="hljs-string">'attachedCallback'</span>:<span class="hljs-number">1</span>,
        <span class="hljs-string">'detachedCallback'</span>:<span class="hljs-number">1</span>
      };

  protoProps.defaults = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-121">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-121">&#182;</a>
              </div>
              <p>For each property passed into our component base class</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _.each(protoProps, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(value, key, protoProps)</span></span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-122">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-122">&#182;</a>
              </div>
              <p>If a configuration property, ignore it</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span>(configProperties[key]){ <span class="hljs-keyword">return</span>; }</pre></div></div>
            
        </li>
        
        
        <li id="section-123">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-123">&#182;</a>
              </div>
              <p>If a primative or backbone type object, or computed property (function which takes no arguments and returns a value) move it to our defaults</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span>(!_.isFunction(value) || value.isModel || value.isComponent || (_.isFunction(value) &amp;&amp; value.length === <span class="hljs-number">0</span> &amp;&amp; value.toString().indexOf(<span class="hljs-string">'return'</span>) &gt; -<span class="hljs-number">1</span>)){
      protoProps.defaults[key] = value;
      <span class="hljs-keyword">delete</span> protoProps[key];
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-124">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-124">&#182;</a>
              </div>
              <p>If a reserved method, yell</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span>(reservedMethods[key]){ <span class="hljs-keyword">throw</span> <span class="hljs-string">"ERROR: "</span> + key + <span class="hljs-string">" is a reserved method name in "</span> + staticProps.__name + <span class="hljs-string">"!"</span>; }</pre></div></div>
            
        </li>
        
        
        <li id="section-125">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-125">&#182;</a>
              </div>
              <p>All other values are component methods, leave them be unless already defined.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
  }, <span class="hljs-keyword">this</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-126">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-126">&#182;</a>
              </div>
              <p>If given a constructor, use it, otherwise use the default one defined above</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (protoProps &amp;&amp; _.has(protoProps, <span class="hljs-string">'constructor'</span>)) {
    child = protoProps.constructor;
  } <span class="hljs-keyword">else</span> {
    child = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{ <span class="hljs-keyword">return</span> parent.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>); };
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-127">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-127">&#182;</a>
              </div>
              <p>Our class should inherit everything from its parent, defined above</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> Surrogate = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{ <span class="hljs-keyword">this</span>.constructor = child; };
  Surrogate.prototype = parent.prototype;
  child.prototype = <span class="hljs-keyword">new</span> Surrogate();</pre></div></div>
            
        </li>
        
        
        <li id="section-128">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-128">&#182;</a>
              </div>
              <p>Extend our prototype with any remaining protoProps, overriting pre-defined ones</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (protoProps){ _.extend(child.prototype, protoProps, staticProps); }</pre></div></div>
            
        </li>
        
        
        <li id="section-129">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-129">&#182;</a>
              </div>
              <p>Set our ancestry</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  child.__super__ = parent.prototype;

  <span class="hljs-keyword">return</span> child;
};

Component.register = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">registerComponent</span><span class="hljs-params">(name, options)</span> </span>{
  <span class="hljs-keyword">var</span> script = options.prototype;
  <span class="hljs-keyword">var</span> template = options.template;
  <span class="hljs-keyword">var</span> style = options.style;

  <span class="hljs-keyword">var</span> component = <span class="hljs-keyword">this</span>.extend(script, { __name: name });
  <span class="hljs-keyword">var</span> proto = <span class="hljs-built_in">Object</span>.create(HTMLElement.prototype, {});

  proto.createdCallback = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">this</span>.__component__ = <span class="hljs-keyword">new</span> component({
      template: template,
      outlet: <span class="hljs-keyword">this</span>,
      data: Rebound.seedData
    });
  };

  proto.attachedCallback = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    script.attachedCallback &amp;&amp; script.attachedCallback.call(<span class="hljs-keyword">this</span>.__component__);
  };

  proto.detachedCallback = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    script.detachedCallback &amp;&amp; script.detachedCallback.call(<span class="hljs-keyword">this</span>.__component__);
    <span class="hljs-keyword">this</span>.__component__.deinitialize();
  };

  proto.attributeChangedCallback = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(attrName, oldVal, newVal)</span> </span>{
    <span class="hljs-keyword">this</span>.__component__._onAttributeChange(attrName, oldVal, newVal);
    script.attributeChangedCallback &amp;&amp; script.attributeChangedCallback.call(<span class="hljs-keyword">this</span>.__component__, attrName, oldVal, newVal);
  };

  <span class="hljs-keyword">return</span> <span class="hljs-built_in">document</span>.registerElement(name, { prototype: proto });
}

_.bindAll(Component, <span class="hljs-string">'register'</span>);

export <span class="hljs-keyword">default</span> Component;</pre></div></div>
            
        </li>
        
        
        <li id="section-130">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-130">&#182;</a>
              </div>
              <h2 id="rebound-helpers">Rebound Helpers</h2>

            </div>
            
        </li>
        
        
        <li id="section-131">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-131">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
import LazyValue from <span class="hljs-string">"rebound-component/lazy-value"</span>;
import $ from <span class="hljs-string">"rebound-component/utils"</span>;


<span class="hljs-keyword">var</span> helpers  = {},
    partials = {};

helpers.registerPartial = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name, func)</span></span>{
  <span class="hljs-keyword">if</span>(func &amp;&amp; func.isHTMLBars &amp;&amp; <span class="hljs-keyword">typeof</span> name === <span class="hljs-string">'string'</span>){
    partials[name] = func;
  }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-132">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-132">&#182;</a>
              </div>
              <p>lookupHelper returns the given function from the helpers object. Manual checks prevent user from overriding reserved words.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>helpers.lookupHelper = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name, env, context)</span> </span>{

  env = env || {};

  name = $.splitPath(name)[<span class="hljs-number">0</span>];</pre></div></div>
            
        </li>
        
        
        <li id="section-133">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-133">&#182;</a>
              </div>
              <p>If a reserved helpers, return it</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span>(name === <span class="hljs-string">'attribute'</span>) { <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.attribute; }
  <span class="hljs-keyword">if</span>(name === <span class="hljs-string">'if'</span>) { <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.if; }
  <span class="hljs-keyword">if</span>(name === <span class="hljs-string">'unless'</span>) { <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.unless; }
  <span class="hljs-keyword">if</span>(name === <span class="hljs-string">'each'</span>) { <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.each; }
  <span class="hljs-keyword">if</span>(name === <span class="hljs-string">'with'</span>) { <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.with; }
  <span class="hljs-keyword">if</span>(name === <span class="hljs-string">'partial'</span>) { <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.partial; }
  <span class="hljs-keyword">if</span>(name === <span class="hljs-string">'length'</span>) { <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.length; }
  <span class="hljs-keyword">if</span>(name === <span class="hljs-string">'on'</span>) { <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.on; }</pre></div></div>
            
        </li>
        
        
        <li id="section-134">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-134">&#182;</a>
              </div>
              <p>If not a reserved helper, check env, then global helpers, else return false</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">return</span> (env.helpers &amp;&amp; _.isObject(context) &amp;&amp; _.isObject(env.helpers[context.cid]) &amp;&amp; env.helpers[context.cid][name]) || helpers[name] || <span class="hljs-literal">false</span>;
};

helpers.registerHelper = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(name, callback, params)</span></span>{
  <span class="hljs-keyword">if</span>(!_.isString(name)){
    <span class="hljs-built_in">console</span>.error(<span class="hljs-string">'Name provided to registerHelper must be a string!'</span>);
    <span class="hljs-keyword">return</span>;
  }
  <span class="hljs-keyword">if</span>(!_.isFunction(callback)){
    <span class="hljs-built_in">console</span>.error(<span class="hljs-string">'Callback provided to regierHelper must be a function!'</span>);
    <span class="hljs-keyword">return</span>;
  }
  <span class="hljs-keyword">if</span>(helpers.lookupHelper(name)){
    <span class="hljs-built_in">console</span>.error(<span class="hljs-string">'A helper called "'</span> + name + <span class="hljs-string">'" is already registered!'</span>);
    <span class="hljs-keyword">return</span>;
  }

  params = (_.isArray(params)) ? params : [params];
  callback.__params = params;

  helpers[name] = callback;

};

<span class="hljs-comment">/*******************************
        Default helpers
********************************/</span>

helpers.on = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(params, hash, options, env)</span></span>{
  <span class="hljs-keyword">var</span> i, callback, delegate, element,
      eventName = params[<span class="hljs-number">0</span>],
      len = params.length,
      data = hash;</pre></div></div>
            
        </li>
        
        
        <li id="section-135">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-135">&#182;</a>
              </div>
              <p>By default everything is delegated on the parent component</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span>(len === <span class="hljs-number">2</span>){
    callback = params[<span class="hljs-number">1</span>];
    delegate = options.element;
    element = (<span class="hljs-keyword">this</span>.el || options.element);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-136">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-136">&#182;</a>
              </div>
              <p>If a selector is provided, delegate on the helper’s element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(len === <span class="hljs-number">3</span>){
    callback = params[<span class="hljs-number">2</span>];
    delegate = params[<span class="hljs-number">1</span>];
    element = options.element;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-137">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-137">&#182;</a>
              </div>
              <p>Attach event</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  $(element).on(eventName, delegate, data, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(event)</span></span>{
    event.context = options.context;
    <span class="hljs-keyword">return</span> options.helpers.__callOnComponent(callback, event);
  });
};

helpers.length = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(params, hash, options, env)</span></span>{
    <span class="hljs-keyword">return</span> params[<span class="hljs-number">0</span>] &amp;&amp; params[<span class="hljs-number">0</span>].length || <span class="hljs-number">0</span>;
};

helpers.if = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(params, hash, options, env)</span></span>{

  <span class="hljs-keyword">var</span> condition = params[<span class="hljs-number">0</span>];

  <span class="hljs-keyword">if</span>(condition === <span class="hljs-literal">undefined</span>){
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
  }

  <span class="hljs-keyword">if</span>(condition.isModel){
    condition = <span class="hljs-literal">true</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-138">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-138">&#182;</a>
              </div>
              <p>If our condition is an array, handle properly</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span>(_.isArray(condition) || condition.isCollection){
    condition = condition.length ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>;
  }

  <span class="hljs-keyword">if</span>(condition === <span class="hljs-string">'true'</span>){ condition = <span class="hljs-literal">true</span>; }
  <span class="hljs-keyword">if</span>(condition === <span class="hljs-string">'false'</span>){ condition = <span class="hljs-literal">false</span>; }</pre></div></div>
            
        </li>
        
        
        <li id="section-139">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-139">&#182;</a>
              </div>
              <p>If more than one param, this is not a block helper. Eval as such.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span>(params.length &gt; <span class="hljs-number">1</span>){
    <span class="hljs-keyword">return</span> (condition) ? params[<span class="hljs-number">1</span>] : ( params[<span class="hljs-number">2</span>] || <span class="hljs-string">''</span>);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-140">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-140">&#182;</a>
              </div>
              <p>Check our cache. If the value hasn’t actually changed, don’t evaluate. Important for re-rendering of #each helpers.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span>(options.placeholder.__ifCache === condition){
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; <span class="hljs-comment">// Return null prevent's re-rending of our placeholder.</span>
  }

  options.placeholder.__ifCache = condition;</pre></div></div>
            
        </li>
        
        
        <li id="section-141">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-141">&#182;</a>
              </div>
              <p>Render the apropreate block statement</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span>(condition &amp;&amp; options.template){
    <span class="hljs-keyword">return</span> options.template.render(options.context, options, (options.morph.contextualElement || options.morph.element));
  }
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(!condition &amp;&amp; options.inverse){
    <span class="hljs-keyword">return</span> options.inverse.render(options.context, options, (options.morph.contextualElement || options.morph.element));
  }

  <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-142">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-142">&#182;</a>
              </div>
              <p>TODO: Proxy to if helper with inverted params</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>helpers.unless = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(params, hash, options, env)</span></span>{
  <span class="hljs-keyword">var</span> condition = params[<span class="hljs-number">0</span>];

  <span class="hljs-keyword">if</span>(condition === <span class="hljs-literal">undefined</span>){
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
  }

  <span class="hljs-keyword">if</span>(condition.isModel){
    condition = <span class="hljs-literal">true</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-143">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-143">&#182;</a>
              </div>
              <p>If our condition is an array, handle properly</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span>(_.isArray(condition) || condition.isCollection){
    condition = condition.length ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-144">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-144">&#182;</a>
              </div>
              <p>If more than one param, this is not a block helper. Eval as such.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span>(params.length &gt; <span class="hljs-number">1</span>){
    <span class="hljs-keyword">return</span> (!condition) ? params[<span class="hljs-number">1</span>] : ( params[<span class="hljs-number">2</span>] || <span class="hljs-string">''</span>);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-145">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-145">&#182;</a>
              </div>
              <p>Check our cache. If the value hasn’t actually changed, don’t evaluate. Important for re-rendering of #each helpers.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span>(options.placeholder.__unlessCache === condition){
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; <span class="hljs-comment">// Return null prevent's re-rending of our placeholder.</span>
  }

  options.placeholder.__unlessCache = condition;</pre></div></div>
            
        </li>
        
        
        <li id="section-146">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-146">&#182;</a>
              </div>
              <p>Render the apropreate block statement</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span>(!condition &amp;&amp;  options.template){
    <span class="hljs-keyword">return</span> options.template.render(options.context, options, (options.morph.contextualElement || options.morph.element));
  }
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(condition &amp;&amp; options.inverse){
    <span class="hljs-keyword">return</span> options.inverse.render(options.context, options, (options.morph.contextualElement || options.morph.element));
  }

  <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-147">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-147">&#182;</a>
              </div>
              <p>Given an array, predicate and optional extra variable, finds the index in the array where predicate is true</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">findIndex</span><span class="hljs-params">(arr, predicate, cid)</span> </span>{
  <span class="hljs-keyword">if</span> (arr == <span class="hljs-literal">null</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'findIndex called on null or undefined'</span>);
  }
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> predicate !== <span class="hljs-string">'function'</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'predicate must be a function'</span>);
  }
  <span class="hljs-keyword">var</span> list = <span class="hljs-built_in">Object</span>(arr);
  <span class="hljs-keyword">var</span> length = list.length &gt;&gt;&gt; <span class="hljs-number">0</span>;
  <span class="hljs-keyword">var</span> thisArg = <span class="hljs-built_in">arguments</span>[<span class="hljs-number">1</span>];
  <span class="hljs-keyword">var</span> value;

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; length; i++) {
    value = list[i];
    <span class="hljs-keyword">if</span> (predicate.call(thisArg, value, i, list, cid)) {
      <span class="hljs-keyword">return</span> i;
    }
  }
  <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;
}

helpers.each = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(params, hash, options, env)</span></span>{

  <span class="hljs-keyword">if</span>(_.isNull(params[<span class="hljs-number">0</span>]) || _.isUndefined(params[<span class="hljs-number">0</span>])){ <span class="hljs-built_in">console</span>.warn(<span class="hljs-string">'Undefined value passed to each helper! Maybe try providing a default value?'</span>, options.context); <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; }

  <span class="hljs-keyword">var</span> value = (params[<span class="hljs-number">0</span>].isCollection) ? params[<span class="hljs-number">0</span>].models : params[<span class="hljs-number">0</span>], <span class="hljs-comment">// Accepts collections or arrays</span>
      morph = options.placeholder.firstChildMorph, obj, next, lazyValue, nmorph, i,  <span class="hljs-comment">// used below to remove trailing junk morphs from the dom</span>
      position, <span class="hljs-comment">// Stores the iterated element's integer position in the dom list</span>
      currentModel = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(element, index, array, cid)</span></span>{
        <span class="hljs-keyword">return</span> element.cid === cid; <span class="hljs-comment">// Returns true if currently observed element is the current model.</span>
      };</pre></div></div>
            
        </li>
        
        
        <li id="section-148">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-148">&#182;</a>
              </div>
              <p>For each item in this collection</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i &lt; value.length;i++){
    obj = value[i];
    next = (morph) ? morph.nextMorph : <span class="hljs-literal">null</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-149">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-149">&#182;</a>
              </div>
              <p>If this morph is the rendered version of this model, continue to the next one.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span>(morph &amp;&amp; morph.cid == obj.cid){ morph = next; <span class="hljs-keyword">continue</span>; }</pre></div></div>
            
        </li>
        
        
        <li id="section-150">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-150">&#182;</a>
              </div>
              <p>Create a lazyvalue whos value is the content inside our block helper rendered in the context of this current list object. Returns the rendered dom for this list item.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    lazyValue = <span class="hljs-keyword">new</span> LazyValue(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
      <span class="hljs-keyword">return</span> options.template.render(obj, options, options.placeholder.contextualElement, [obj]);
    }, {morph: options.placeholder});</pre></div></div>
            
        </li>
        
        
        <li id="section-151">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-151">&#182;</a>
              </div>
              <p>Insert our newly rendered value (a document tree) into our placeholder (the containing element) at its requested position (where we currently are in the object list)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    nmorph = options.placeholder.insertContentBeforeMorph(lazyValue.value(), morph);</pre></div></div>
            
        </li>
        
        
        <li id="section-152">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-152">&#182;</a>
              </div>
              <p>Label the inserted morph element with this model’s cid</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    nmorph.cid = obj.cid;</pre></div></div>
            
        </li>
        
        
        <li id="section-153">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-153">&#182;</a>
              </div>
              <p>Destroy the old morph that was here</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    morph &amp;&amp; morph.destroy();</pre></div></div>
            
        </li>
        
        
        <li id="section-154">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-154">&#182;</a>
              </div>
              <p>Move on to the next morph</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    morph = next;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-155">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-155">&#182;</a>
              </div>
              <p>// If any more morphs are left over, remove them. We’ve already gone through all the models.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">while</span>(morph){
    next = morph.nextMorph;
    morph.destroy();
    morph = next;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-156">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-156">&#182;</a>
              </div>
              <p>Return null prevent’s re-rending of our placeholder. Our placeholder (containing element) now has all the dom we need.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;

};

helpers.with = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(params, hash, options, env)</span></span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-157">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-157">&#182;</a>
              </div>
              <p>Render the content inside our block helper with the context of this object. Returns a dom tree.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">return</span> options.template.render(params[<span class="hljs-number">0</span>], options, (options.morph.contextualElement || options.morph.element));

};

helpers.partial = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(params, hash, options, env)</span></span>{
  <span class="hljs-keyword">var</span> partial = partials[params[<span class="hljs-number">0</span>]];
  <span class="hljs-keyword">if</span>( partial &amp;&amp; partial.isHTMLBars ){
    <span class="hljs-keyword">return</span> partial.render(options.context, env);
  }

};

export <span class="hljs-keyword">default</span> helpers;</pre></div></div>
            
        </li>
        
        
        <li id="section-158">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-158">&#182;</a>
              </div>
              <h2 id="rebound-hooks">Rebound Hooks</h2>

            </div>
            
        </li>
        
        
        <li id="section-159">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-159">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
import LazyValue from <span class="hljs-string">"rebound-component/lazy-value"</span>;
import $ from <span class="hljs-string">"rebound-component/utils"</span>;
import helpers from <span class="hljs-string">"rebound-component/helpers"</span>;

<span class="hljs-keyword">var</span> hooks = {},
    attributes = {  abbr: <span class="hljs-number">1</span>,      <span class="hljs-string">"accept-charset"</span>: <span class="hljs-number">1</span>,   accept: <span class="hljs-number">1</span>,      accesskey: <span class="hljs-number">1</span>,     action: <span class="hljs-number">1</span>,
                    align: <span class="hljs-number">1</span>,      alink: <span class="hljs-number">1</span>,             alt: <span class="hljs-number">1</span>,         archive: <span class="hljs-number">1</span>,       axis: <span class="hljs-number">1</span>,
                    background: <span class="hljs-number">1</span>, bgcolor: <span class="hljs-number">1</span>,           border: <span class="hljs-number">1</span>,      cellpadding: <span class="hljs-number">1</span>,   cellspacing: <span class="hljs-number">1</span>,
                    char: <span class="hljs-number">1</span>,       charoff: <span class="hljs-number">1</span>,           charset: <span class="hljs-number">1</span>,     checked: <span class="hljs-number">1</span>,       cite: <span class="hljs-number">1</span>,
                    <span class="hljs-keyword">class</span>: <span class="hljs-number">1</span>,      classid: <span class="hljs-number">1</span>,           clear: <span class="hljs-number">1</span>,       code: <span class="hljs-number">1</span>,          codebase: <span class="hljs-number">1</span>,
                    codetype: <span class="hljs-number">1</span>,   color: <span class="hljs-number">1</span>,             cols: <span class="hljs-number">1</span>,        colspan: <span class="hljs-number">1</span>,       compact: <span class="hljs-number">1</span>,
                    content: <span class="hljs-number">1</span>,    coords: <span class="hljs-number">1</span>,            data: <span class="hljs-number">1</span>,        datetime: <span class="hljs-number">1</span>,      declare: <span class="hljs-number">1</span>,
                    defer: <span class="hljs-number">1</span>,      dir: <span class="hljs-number">1</span>,               disabled: <span class="hljs-number">1</span>,    enctype: <span class="hljs-number">1</span>,       face: <span class="hljs-number">1</span>,
                    <span class="hljs-keyword">for</span>: <span class="hljs-number">1</span>,        frame: <span class="hljs-number">1</span>,             frameborder: <span class="hljs-number">1</span>, headers: <span class="hljs-number">1</span>,       height: <span class="hljs-number">1</span>,
                    href: <span class="hljs-number">1</span>,       hreflang: <span class="hljs-number">1</span>,          hspace: <span class="hljs-number">1</span>,     <span class="hljs-string">"http-equiv"</span>: <span class="hljs-number">1</span>,   id: <span class="hljs-number">1</span>,
                    ismap: <span class="hljs-number">1</span>,      label: <span class="hljs-number">1</span>,             lang: <span class="hljs-number">1</span>,        language: <span class="hljs-number">1</span>,      link: <span class="hljs-number">1</span>,
                    longdesc: <span class="hljs-number">1</span>,   marginheight: <span class="hljs-number">1</span>,      marginwidth: <span class="hljs-number">1</span>, maxlength: <span class="hljs-number">1</span>,     media: <span class="hljs-number">1</span>,
                    method: <span class="hljs-number">1</span>,     multiple: <span class="hljs-number">1</span>,          name: <span class="hljs-number">1</span>,        nohref: <span class="hljs-number">1</span>,        noresize: <span class="hljs-number">1</span>,
                    noshade: <span class="hljs-number">1</span>,    nowrap: <span class="hljs-number">1</span>,            object: <span class="hljs-number">1</span>,      onblur: <span class="hljs-number">1</span>,        onchange: <span class="hljs-number">1</span>,
                    onclick: <span class="hljs-number">1</span>,    ondblclick: <span class="hljs-number">1</span>,        onfocus: <span class="hljs-number">1</span>,     onkeydown: <span class="hljs-number">1</span>,     onkeypress: <span class="hljs-number">1</span>,
                    onkeyup: <span class="hljs-number">1</span>,    onload: <span class="hljs-number">1</span>,            onmousedown: <span class="hljs-number">1</span>, onmousemove: <span class="hljs-number">1</span>,   onmouseout: <span class="hljs-number">1</span>,
                    onmouseover: <span class="hljs-number">1</span>,onmouseup: <span class="hljs-number">1</span>,         onreset: <span class="hljs-number">1</span>,     onselect: <span class="hljs-number">1</span>,      onsubmit: <span class="hljs-number">1</span>,
                    onunload: <span class="hljs-number">1</span>,   profile: <span class="hljs-number">1</span>,           prompt: <span class="hljs-number">1</span>,      readonly: <span class="hljs-number">1</span>,      rel: <span class="hljs-number">1</span>,
                    rev: <span class="hljs-number">1</span>,        rows: <span class="hljs-number">1</span>,              rowspan: <span class="hljs-number">1</span>,     rules: <span class="hljs-number">1</span>,         scheme: <span class="hljs-number">1</span>,
                    scope: <span class="hljs-number">1</span>,      scrolling: <span class="hljs-number">1</span>,         selected: <span class="hljs-number">1</span>,    shape: <span class="hljs-number">1</span>,         size: <span class="hljs-number">1</span>,
                    span: <span class="hljs-number">1</span>,       src: <span class="hljs-number">1</span>,               standby: <span class="hljs-number">1</span>,     start: <span class="hljs-number">1</span>,         style: <span class="hljs-number">1</span>,
                    summary: <span class="hljs-number">1</span>,    tabindex: <span class="hljs-number">1</span>,          target: <span class="hljs-number">1</span>,      text: <span class="hljs-number">1</span>,          title: <span class="hljs-number">1</span>,
                    type: <span class="hljs-number">1</span>,       usemap: <span class="hljs-number">1</span>,            valign: <span class="hljs-number">1</span>,      value: <span class="hljs-number">1</span>,         valuetype: <span class="hljs-number">1</span>,
                    version: <span class="hljs-number">1</span>,    vlink: <span class="hljs-number">1</span>,             vspace: <span class="hljs-number">1</span>,      width: <span class="hljs-number">1</span>  };


<span class="hljs-comment">/*******************************
        Hook Utils
********************************/</span></pre></div></div>
            
        </li>
        
        
        <li id="section-160">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-160">&#182;</a>
              </div>
              <p>Given an object (context) and a path, create a LazyValue object that returns the value of object at context and add it as an observer of the context.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">streamProperty</span><span class="hljs-params">(context, path)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-161">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-161">&#182;</a>
              </div>
              <p>Lazy value that returns the value of context.path</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> lazyValue = <span class="hljs-keyword">new</span> LazyValue(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> context.get(path);
  }, {context: context});</pre></div></div>
            
        </li>
        
        
        <li id="section-162">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-162">&#182;</a>
              </div>
              <p>Save our path so parent lazyvalues can know the data var or helper they are getting info from</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  lazyValue.path = path;</pre></div></div>
            
        </li>
        
        
        <li id="section-163">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-163">&#182;</a>
              </div>
              <p>Save the observer at this path</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  lazyValue.addObserver(path, context);

  <span class="hljs-keyword">return</span> lazyValue;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">constructHelper</span><span class="hljs-params">(el, path, context, params, hash, options, env, helper)</span> </span>{
  <span class="hljs-keyword">var</span> lazyValue;</pre></div></div>
            
        </li>
        
        
        <li id="section-164">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-164">&#182;</a>
              </div>
              <p>Extend options with the helper’s containeing Morph element. Used by streamify to track data observers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  options.morph = options.placeholder = el &amp;&amp; !el.tagName &amp;&amp; el || <span class="hljs-literal">false</span>; <span class="hljs-comment">// FIXME: this kinda sucks</span>
  options.element = el &amp;&amp; el.tagName &amp;&amp; el || <span class="hljs-literal">false</span>;      <span class="hljs-comment">// FIXME: this kinda sucks</span></pre></div></div>
            
        </li>
        
        
        <li id="section-165">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-165">&#182;</a>
              </div>
              <p>Extend options with hooks and helpers for any subsequent calls from a lazyvalue</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  options.params = params;                                 <span class="hljs-comment">// FIXME: this kinda sucks</span>
  options.hooks = env.hooks;                               <span class="hljs-comment">// FIXME: this kinda sucks</span>
  options.helpers = env.helpers;                           <span class="hljs-comment">// FIXME: this kinda sucks</span>
  options.context = context;                               <span class="hljs-comment">// FIXME: this kinda sucks</span>
  options.dom = env.dom;                                   <span class="hljs-comment">// FIXME: this kinda sucks</span>
  options.path = path;                                     <span class="hljs-comment">// FIXME: this kinda sucks</span>
  options.hash = hash || [];                               <span class="hljs-comment">// FIXME: this kinda sucks</span></pre></div></div>
            
        </li>
        
        
        <li id="section-166">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-166">&#182;</a>
              </div>
              <p>Create a lazy value that returns the value of our evaluated helper.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  options.lazyValue = <span class="hljs-keyword">new</span> LazyValue(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">var</span> plainParams = [],
        plainHash = {},
        result,
        relpath = $.splitPath(path),
        first, rest;
        relpath.shift();
        relpath = relpath.join(<span class="hljs-string">'.'</span>);

        rest = $.splitPath(relpath);
        first = rest.shift();
        rest = rest.join(<span class="hljs-string">'.'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-167">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-167">&#182;</a>
              </div>
              <p>Assemble our args and hash variables. For each lazyvalue param, push the lazyValue’s value so helpers with no concept of lazyvalues.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _.each(params, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(param, index)</span></span>{
      plainParams.push(( (param &amp;&amp; param.isLazyValue) ? param.value() : param ));
    });
    _.each(hash, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(hash, key)</span></span>{
      plainHash[key] = (hash &amp;&amp; hash.isLazyValue) ? hash.value() : hash;
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-168">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-168">&#182;</a>
              </div>
              <p>Call our helper functions with our assembled args.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    result = helper.apply((context.__root__ || context), [plainParams, plainHash, options, env]);

    <span class="hljs-keyword">if</span>(result &amp;&amp; relpath){
      <span class="hljs-keyword">return</span> result.get(relpath);
    }

    <span class="hljs-keyword">return</span> result;
  }, {morph: options.morph});

  options.lazyValue.path = path;</pre></div></div>
            
        </li>
        
        
        <li id="section-169">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-169">&#182;</a>
              </div>
              <p>For each param passed to our helper, add it to our helper’s dependant list. Helper will re-evaluate when one changes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  params.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(node)</span> </span>{
    <span class="hljs-keyword">if</span> (node &amp;&amp; node.isLazyValue) {
      options.lazyValue.addDependentValue(node);
    }
  });

  <span class="hljs-keyword">return</span> options.lazyValue;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-170">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-170">&#182;</a>
              </div>
              <p>Given a root element, cleans all of the morph lazyValues for a given subtree</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">cleanSubtree</span><span class="hljs-params">(mutations, observer)</span></span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-171">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-171">&#182;</a>
              </div>
              <p>For each mutation observed, if there are nodes removed, destroy all associated lazyValues</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  mutations.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(mutation)</span> </span>{
    <span class="hljs-keyword">if</span>(mutation.removedNodes){
      _.each(mutation.removedNodes, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(node, index)</span></span>{
        $(node).walkTheDOM(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(n)</span></span>{
          <span class="hljs-keyword">if</span>(n.__lazyValue &amp;&amp; n.__lazyValue.destroy()){
            n.__lazyValue.destroy();
          }
        });
      });
    }
  });
}

<span class="hljs-keyword">var</span> subtreeObserver = <span class="hljs-keyword">new</span> MutationObserver(cleanSubtree);

<span class="hljs-comment">/*******************************
        Default Hooks
********************************/</span>

hooks.get = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get</span><span class="hljs-params">(env, context, path)</span></span>{
  context.blockParams || (context.blockParams = {});
  <span class="hljs-keyword">if</span>(path === <span class="hljs-string">'this'</span>){ path = <span class="hljs-string">''</span>; }</pre></div></div>
            
        </li>
        
        
        <li id="section-172">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-172">&#182;</a>
              </div>
              <p>context = (context.blockParams.has(path)) ? context.blockParams : context;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">return</span> streamProperty(context, path);
};

hooks.set = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">set</span><span class="hljs-params">(env, context, name, value)</span></span>{
  context.blockParams || (context.blockParams = {});</pre></div></div>
            
        </li>
        
        
        <li id="section-173">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-173">&#182;</a>
              </div>
              <p>context.blockParams.set(name, value);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>};


hooks.concat = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">concat</span><span class="hljs-params">(env, params)</span> </span>{

  <span class="hljs-keyword">if</span>(params.length === <span class="hljs-number">1</span>){
    <span class="hljs-keyword">return</span> params[<span class="hljs-number">0</span>];
  }

  <span class="hljs-keyword">var</span> lazyValue = <span class="hljs-keyword">new</span> LazyValue(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">var</span> value = <span class="hljs-string">""</span>;

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, l = params.length; i &lt; l; i++) {
      value += (params[i].isLazyValue) ? params[i].value() : params[i];
    }

    <span class="hljs-keyword">return</span> value;
  }, {context: params[<span class="hljs-number">0</span>].context});

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, l = params.length; i &lt; l; i++) {
    <span class="hljs-keyword">if</span>(params[i].isLazyValue) {
      lazyValue.addDependentValue(params[i]);
    }
  }

  <span class="hljs-keyword">return</span> lazyValue;

};

hooks.subexpr = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">subexpr</span><span class="hljs-params">(env, context, helperName, params, hash)</span> </span>{

  <span class="hljs-keyword">var</span> helper = helpers.lookupHelper(helperName, env, context),
  lazyValue;

  <span class="hljs-keyword">if</span> (helper) {</pre></div></div>
            
        </li>
        
        
        <li id="section-174">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-174">&#182;</a>
              </div>
              <p>Abstracts our helper to provide a handlebars type interface. Constructs our LazyValue.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    lazyValue = constructHelper(<span class="hljs-literal">false</span>, helperName, context, params, hash, {}, env, helper);
  } <span class="hljs-keyword">else</span> {
    lazyValue = streamProperty(context, helperName);
  }

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, l = params.length; i &lt; l; i++) {
    <span class="hljs-keyword">if</span>(params[i].isLazyValue) {
      lazyValue.addDependentValue(params[i]);
    }
  }

  <span class="hljs-keyword">return</span> lazyValue;
};

hooks.block = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">block</span><span class="hljs-params">(env, morph, context, path, params, hash, template, inverse)</span></span>{
  <span class="hljs-keyword">var</span> options = {
    morph: morph,
    template: template,
    inverse: inverse
  };

  <span class="hljs-keyword">var</span> lazyValue,
  value,
  observer = subtreeObserver,
  helper = helpers.lookupHelper(path, env, context);

  <span class="hljs-keyword">if</span>(!_.isFunction(helper)){
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">console</span>.error(path + <span class="hljs-string">' is not a valid helper!'</span>);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-175">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-175">&#182;</a>
              </div>
              <p>Abstracts our helper to provide a handlebars type interface. Constructs our LazyValue.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  lazyValue = constructHelper(morph, path, context, params, hash, options, env, helper);</pre></div></div>
            
        </li>
        
        
        <li id="section-176">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-176">&#182;</a>
              </div>
              <p>If we have our lazy value, update our dom.
morph is a morph element representing our dom node</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (lazyValue) {
    lazyValue.onNotify(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(lazyValue)</span> </span>{
      <span class="hljs-keyword">var</span> val = lazyValue.value();
      val = (_.isUndefined(val)) ? <span class="hljs-string">''</span> : val;
      <span class="hljs-keyword">if</span>(!_.isNull(val)){
        morph.setContent(val);
      }
    });

    value = lazyValue.value();
    value = (_.isUndefined(value)) ? <span class="hljs-string">''</span> : value;
    <span class="hljs-keyword">if</span>(!_.isNull(value)){ morph.appendContent(value); }</pre></div></div>
            
        </li>
        
        
        <li id="section-177">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-177">&#182;</a>
              </div>
              <p>Observe this content morph’s parent’s children.
When the morph element’s containing element (morph) is removed, clean up the lazyvalue.
Timeout delay hack to give out dom a change to get their parent</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span>(morph._parent){
        morph._parent.__lazyValue = lazyValue;
        setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
          <span class="hljs-keyword">if</span>(morph.contextualElement){
            observer.observe(morph.contextualElement, { attributes: <span class="hljs-literal">false</span>, childList: <span class="hljs-literal">true</span>, characterData: <span class="hljs-literal">false</span>, subtree: <span class="hljs-literal">true</span> });
          }
        }, <span class="hljs-number">0</span>);
      }

    }

};

hooks.inline = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">inline</span><span class="hljs-params">(env, morph, context, path, params, hash)</span> </span>{

  <span class="hljs-keyword">var</span> lazyValue,
  value,
  observer = subtreeObserver,
  helper = helpers.lookupHelper(path, env, context);

  <span class="hljs-keyword">if</span>(!_.isFunction(helper)){
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">console</span>.error(path + <span class="hljs-string">' is not a valid helper!'</span>);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-178">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-178">&#182;</a>
              </div>
              <p>Abstracts our helper to provide a handlebars type interface. Constructs our LazyValue.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  lazyValue = constructHelper(morph, path, context, params, hash, {}, env, helper);</pre></div></div>
            
        </li>
        
        
        <li id="section-179">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-179">&#182;</a>
              </div>
              <p>If we have our lazy value, update our dom.
morph is a morph element representing our dom node</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (lazyValue) {
    lazyValue.onNotify(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(lazyValue)</span> </span>{
      <span class="hljs-keyword">var</span> val = lazyValue.value();
      val = (_.isUndefined(val)) ? <span class="hljs-string">''</span> : val;
      <span class="hljs-keyword">if</span>(!_.isNull(val)){
        morph.setContent(val);
      }
    });

    value = lazyValue.value();
    value = (_.isUndefined(value)) ? <span class="hljs-string">''</span> : value;
    <span class="hljs-keyword">if</span>(!_.isNull(value)){ morph.appendContent(value); }</pre></div></div>
            
        </li>
        
        
        <li id="section-180">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-180">&#182;</a>
              </div>
              <p>Observe this content morph’s parent’s children.
When the morph element’s containing element (morph) is removed, clean up the lazyvalue.
Timeout delay hack to give out dom a change to get their parent</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span>(morph._parent){
        morph._parent.__lazyValue = lazyValue;
        setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
          <span class="hljs-keyword">if</span>(morph.contextualElement){
            observer.observe(morph.contextualElement, { attributes: <span class="hljs-literal">false</span>, childList: <span class="hljs-literal">true</span>, characterData: <span class="hljs-literal">false</span>, subtree: <span class="hljs-literal">true</span> });
          }
        }, <span class="hljs-number">0</span>);
      }

    }
  };

hooks.content = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">content</span><span class="hljs-params">(env, morph, context, path)</span> </span>{

  <span class="hljs-keyword">var</span> lazyValue,
      value,
      observer = subtreeObserver,
      helper = helpers.lookupHelper(path, env, context);

  lazyValue = streamProperty(context, path);</pre></div></div>
            
        </li>
        
        
        <li id="section-181">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-181">&#182;</a>
              </div>
              <p>If we have our lazy value, update our dom.
morph is a morph element representing our dom node</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (lazyValue) {
    lazyValue.onNotify(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(lazyValue)</span> </span>{
      <span class="hljs-keyword">var</span> val = lazyValue.value();
      val = (_.isUndefined(val)) ? <span class="hljs-string">''</span> : val;
      <span class="hljs-keyword">if</span>(!_.isNull(val)){
        morph.setContent(val);
      }
    });

    value = lazyValue.value();
    value = (_.isUndefined(value)) ? <span class="hljs-string">''</span> : value;
    <span class="hljs-keyword">if</span>(!_.isNull(value)){ morph.appendContent(value); }</pre></div></div>
            
        </li>
        
        
        <li id="section-182">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-182">&#182;</a>
              </div>
              <p>Observe this content morph’s parent’s children.
When the morph element’s containing element (morph) is removed, clean up the lazyvalue.
Timeout delay hack to give out dom a change to get their parent</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span>(morph._parent){
      morph._parent.__lazyValue = lazyValue;
      setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
        <span class="hljs-keyword">if</span>(morph.contextualElement){
          observer.observe(morph.contextualElement, { attributes: <span class="hljs-literal">false</span>, childList: <span class="hljs-literal">true</span>, characterData: <span class="hljs-literal">false</span>, subtree: <span class="hljs-literal">true</span> });
        }
      }, <span class="hljs-number">0</span>);
    }

  }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-183">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-183">&#182;</a>
              </div>
              <p>Handle morphs in element tags
TODO: handle dynamic attribute names?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>hooks.element = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">element</span><span class="hljs-params">(env, domElement, context, path, params, hash)</span> </span>{
  <span class="hljs-keyword">var</span> helper = helpers.lookupHelper(path, env, context),
      lazyValue,
      value;

  <span class="hljs-keyword">if</span> (helper) {</pre></div></div>
            
        </li>
        
        
        <li id="section-184">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-184">&#182;</a>
              </div>
              <p>Abstracts our helper to provide a handlebars type interface. Constructs our LazyValue.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    lazyValue = constructHelper(domElement, path, context, params, hash, {}, env, helper);
  } <span class="hljs-keyword">else</span> {
    lazyValue = streamProperty(context, path);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-185">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-185">&#182;</a>
              </div>
              <p>When we have our lazy value run it and start listening for updates.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  lazyValue.onNotify(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(lazyValue)</span> </span>{
    lazyValue.value();
  });

  value = lazyValue.value();

};
hooks.attribute = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">attribute</span><span class="hljs-params">(env, attrMorph, domElement, name, value)</span></span>{

  <span class="hljs-keyword">var</span> lazyValue = <span class="hljs-keyword">new</span> LazyValue(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">var</span> val = value.value(),
    checkboxChange,
    type = domElement.getAttribute(<span class="hljs-string">"type"</span>),

    inputTypes = {  <span class="hljs-string">'null'</span>: <span class="hljs-literal">true</span>,  <span class="hljs-string">'text'</span>:<span class="hljs-literal">true</span>,   <span class="hljs-string">'email'</span>:<span class="hljs-literal">true</span>,  <span class="hljs-string">'password'</span>:<span class="hljs-literal">true</span>,
                    <span class="hljs-string">'search'</span>:<span class="hljs-literal">true</span>, <span class="hljs-string">'url'</span>:<span class="hljs-literal">true</span>,    <span class="hljs-string">'tel'</span>:<span class="hljs-literal">true</span>,    <span class="hljs-string">'hidden'</span>:<span class="hljs-literal">true</span>,
                    <span class="hljs-string">'number'</span>:<span class="hljs-literal">true</span>, <span class="hljs-string">'color'</span>: <span class="hljs-literal">true</span>, <span class="hljs-string">'date'</span>: <span class="hljs-literal">true</span>,  <span class="hljs-string">'datetime'</span>: <span class="hljs-literal">true</span>,
                    <span class="hljs-string">'datetime-local:'</span>: <span class="hljs-literal">true</span>,      <span class="hljs-string">'month'</span>: <span class="hljs-literal">true</span>, <span class="hljs-string">'range'</span>: <span class="hljs-literal">true</span>,
                    <span class="hljs-string">'time'</span>: <span class="hljs-literal">true</span>,  <span class="hljs-string">'week'</span>: <span class="hljs-literal">true</span>
                  },
    attr;</pre></div></div>
            
        </li>
        
        
        <li id="section-186">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-186">&#182;</a>
              </div>
              <p>If is a text input element’s value prop with only one variable, wire default events</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span>( domElement.tagName === <span class="hljs-string">'INPUT'</span> &amp;&amp; inputTypes[type] &amp;&amp; name === <span class="hljs-string">'value'</span> ){</pre></div></div>
            
        </li>
        
        
        <li id="section-187">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-187">&#182;</a>
              </div>
              <p>If our special input events have not been bound yet, bind them and set flag</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span>(!lazyValue.inputObserver){

        $(domElement).on(<span class="hljs-string">'change input propertychange'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(event)</span></span>{
          value.set(value.path, <span class="hljs-keyword">this</span>.value);
        });

        lazyValue.inputObserver = <span class="hljs-literal">true</span>;

      }</pre></div></div>
            
        </li>
        
        
        <li id="section-188">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-188">&#182;</a>
              </div>
              <p>Set the attribute on our element for visual referance</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      (_.isUndefined(val)) ? domElement.removeAttribute(name) : domElement.setAttribute(name, val);

      attr = val;

      <span class="hljs-keyword">return</span> (domElement.value !== <span class="hljs-built_in">String</span>(attr)) ? domElement.value = (attr || <span class="hljs-string">''</span>) : attr;
    }

    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>( domElement.tagName === <span class="hljs-string">'INPUT'</span> &amp;&amp; (type === <span class="hljs-string">'checkbox'</span> || type === <span class="hljs-string">'radio'</span>) &amp;&amp; name === <span class="hljs-string">'checked'</span> ){</pre></div></div>
            
        </li>
        
        
        <li id="section-189">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-189">&#182;</a>
              </div>
              <p>If our special input events have not been bound yet, bind them and set flag</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span>(!lazyValue.eventsBound){

        $(domElement).on(<span class="hljs-string">'change propertychange'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(event)</span></span>{
          value.set(value.path, ((<span class="hljs-keyword">this</span>.checked) ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>), {quiet: <span class="hljs-literal">true</span>});
        });

        lazyValue.eventsBound = <span class="hljs-literal">true</span>;
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-190">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-190">&#182;</a>
              </div>
              <p>Set the attribute on our element for visual referance</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      (!val) ? domElement.removeAttribute(name) : domElement.setAttribute(name, val);

      <span class="hljs-keyword">return</span> domElement.checked = (val) ? <span class="hljs-literal">true</span> : <span class="hljs-literal">undefined</span>;
    }

    <span class="hljs-keyword">else</span> {
      _.isString(val) &amp;&amp; (val = val.trim());
      val || (val = <span class="hljs-literal">undefined</span>);
      <span class="hljs-keyword">if</span>(_.isUndefined(val)){
        domElement.removeAttribute(name);
      }
      <span class="hljs-keyword">else</span>{
        domElement.setAttribute(name, val);
      }
    }

    <span class="hljs-keyword">return</span> val;

  }, {attrMorph: attrMorph});

  value.onNotify(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    lazyValue.value();
  });
  lazyValue.addDependentValue(value);

  <span class="hljs-keyword">return</span> lazyValue.value();

};

hooks.component = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(env, morph, context, tagName, contextData, template)</span> </span>{

  <span class="hljs-keyword">var</span> component,
      element,
      outlet,
      plainData = {},
      componentData = {},
      lazyValue,
      value;</pre></div></div>
            
        </li>
        
        
        <li id="section-191">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-191">&#182;</a>
              </div>
              <p>Create a lazy value that returns the value of our evaluated component.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  lazyValue = <span class="hljs-keyword">new</span> LazyValue(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-192">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-192">&#182;</a>
              </div>
              <p>Create a plain data object from the lazyvalues/values passed to our component</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _.each(contextData, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(value, key)</span> </span>{
      plainData[key] = (value.isLazyValue) ? value.value() : value;
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-193">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-193">&#182;</a>
              </div>
              <p>For each param passed to our shared component, add it to our custom element
TODO: there has to be a better way to get seed data to element instances
Global seed data is consumed by element as its created. This is not scoped and very dumb.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    Rebound.seedData = plainData;
    element = <span class="hljs-built_in">document</span>.createElement(tagName);
    Rebound.seedData = {};
    component = element.__component__;</pre></div></div>
            
        </li>
        
        
        <li id="section-194">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-194">&#182;</a>
              </div>
              <p>For each lazy param passed to our component, create its lazyValue</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _.each(plainData, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(value, key)</span> </span>{
      <span class="hljs-keyword">if</span>(contextData[key] &amp;&amp; contextData[key].isLazyValue){
        componentData[key] = streamProperty(component, key);
      }
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-195">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-195">&#182;</a>
              </div>
              <p>Set up two way binding between component and original context for non-data attributes
Syncing between models and collections passed are handled in model and collection</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _.each( componentData, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(componentDataValue, key)</span></span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-196">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-196">&#182;</a>
              </div>
              <p>TODO: Make this sync work with complex arguments with more than one child</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span>(contextData[key].children === <span class="hljs-literal">null</span>){</pre></div></div>
            
        </li>
        
        
        <li id="section-197">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-197">&#182;</a>
              </div>
              <p>For each lazy param passed to our component, have it update the original context when changed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        componentDataValue.onNotify(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
          contextData[key].set(contextData[key].path, componentDataValue.value());
        });
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-198">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-198">&#182;</a>
              </div>
              <p>For each lazy param passed to our component, have it update the component when changed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      contextData[key].onNotify(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
        componentDataValue.set(key, contextData[key].value());
      });</pre></div></div>
            
        </li>
        
        
        <li id="section-199">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-199">&#182;</a>
              </div>
              <p>Seed the cache</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      componentDataValue.value();</pre></div></div>
            
        </li>
        
        
        <li id="section-200">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-200">&#182;</a>
              </div>
              <p>Notify the component’s lazyvalue when our model updates</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      contextData[key].addObserver(contextData[key].path, context);
      componentDataValue.addObserver(key, component);

    });</pre></div></div>
            
        </li>
        
        
        <li id="section-201">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-201">&#182;</a>
              </div>
              <p>// For each change on our component, update the states of the original context and the element’s proeprties.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    component.listenTo(component, <span class="hljs-string">'change'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(model)</span></span>{
      <span class="hljs-keyword">var</span> json = component.toJSON();

      <span class="hljs-keyword">if</span>(_.isString(json)) <span class="hljs-keyword">return</span>; <span class="hljs-comment">// If is a string, this model is seralizing already</span></pre></div></div>
            
        </li>
        
        
        <li id="section-202">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-202">&#182;</a>
              </div>
              <p>Set the properties on our element for visual referance if we are on a top level attribute</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      _.each(json, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(value, key)</span></span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-203">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-203">&#182;</a>
              </div>
              <p>TODO: Currently, showing objects as properties on the custom element causes problems.
Linked models between the context and component become the same exact model and all hell breaks loose.
Find a way to remedy this. Until then, don’t show objects.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span>((_.isObject(value))){ <span class="hljs-keyword">return</span>; }
        value = (_.isObject(value)) ? <span class="hljs-built_in">JSON</span>.stringify(value) : value;
          <span class="hljs-keyword">try</span>{ (attributes[key]) ? element.setAttribute(key, value) : element.dataset[key] = value; }
          <span class="hljs-keyword">catch</span>(e){
            <span class="hljs-built_in">console</span>.error(e.message);
          }
      });
    });

    <span class="hljs-comment">/** The attributeChangedCallback on our custom element updates the component's data. **/</span>


  <span class="hljs-comment">/*******************************************************

    End data dependancy chain

  *******************************************************/</span></pre></div></div>
            
        </li>
        
        
        <li id="section-204">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-204">&#182;</a>
              </div>
              <p>TODO: break this out into its own function
Set the properties on our element for visual referance if we are on a top level attribute</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> compjson = component.toJSON();
    _.each(compjson, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(value, key)</span></span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-205">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-205">&#182;</a>
              </div>
              <p>TODO: Currently, showing objects as properties on the custom element causes problems. Linked models between the context and component become the same exact model and all hell breaks loose. Find a way to remedy this. Until then, don’t show objects.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span>((_.isObject(value))){ <span class="hljs-keyword">return</span>; }
      value = (_.isObject(value)) ? <span class="hljs-built_in">JSON</span>.stringify(value) : value;
      <span class="hljs-keyword">if</span>(!_.isNull(value) &amp;&amp; !_.isUndefined(value)){
        <span class="hljs-keyword">try</span>{ (attributes[key]) ? element.setAttribute(key, value) : element.dataset[key] = value; }
        <span class="hljs-keyword">catch</span>(e){
          <span class="hljs-built_in">console</span>.error(e.message);
        }
      }
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-206">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-206">&#182;</a>
              </div>
              <p>If an outlet marker is present in component’s template, and a template is provided, render it into <content></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    outlet = element.getElementsByTagName(<span class="hljs-string">'content'</span>)[<span class="hljs-number">0</span>];
    <span class="hljs-keyword">if</span>(template &amp;&amp; _.isElement(outlet)){
      outlet.appendChild(template.render(context, env, outlet));
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-207">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-207">&#182;</a>
              </div>
              <p>Return the new element.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">return</span> element;
  }, {morph: morph});</pre></div></div>
            
        </li>
        
        
        <li id="section-208">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-208">&#182;</a>
              </div>
              <p>If we have our lazy value, update our dom.
morph is a morph element representing our dom node</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (lazyValue) {
    lazyValue.onNotify(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(lazyValue)</span> </span>{
      <span class="hljs-keyword">var</span> val = lazyValue.value();
      <span class="hljs-keyword">if</span>(val !== <span class="hljs-literal">undefined</span>){ morph.setContent(val); }
    });

    value = lazyValue.value();
    <span class="hljs-keyword">if</span>(value !== <span class="hljs-literal">undefined</span>){ morph.appendContent(value); }
  }
};</pre></div></div>
            
        </li>
        
        
        <li id="section-209">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-209">&#182;</a>
              </div>
              <p>registerHelper is a publically available function to register a helper with HTMLBars</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
export <span class="hljs-keyword">default</span> hooks;</pre></div></div>
            
        </li>
        
        
        <li id="section-210">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-210">&#182;</a>
              </div>
              <h2 id="rebound-lazy-value">Rebound Lazy Value</h2>

            </div>
            
        </li>
        
        
        <li id="section-211">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-211">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">var</span> NIL = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">NIL</span><span class="hljs-params">()</span></span>{},
    EMPTY_ARRAY = [];

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">LazyValue</span><span class="hljs-params">(fn, options)</span> </span>{
  options || (options = {})
  <span class="hljs-keyword">this</span>.cid = _.uniqueId(<span class="hljs-string">'lazyValue'</span>);
  <span class="hljs-keyword">this</span>.valueFn = fn;
  <span class="hljs-keyword">this</span>.context = options.context || <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">this</span>.morph = options.morph || <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">this</span>.attrMorph = options.attrMorph || <span class="hljs-literal">null</span>;
  _.bindAll(<span class="hljs-keyword">this</span>, <span class="hljs-string">'value'</span>, <span class="hljs-string">'set'</span>, <span class="hljs-string">'addDependentValue'</span>, <span class="hljs-string">'addObserver'</span>, <span class="hljs-string">'notify'</span>, <span class="hljs-string">'onNotify'</span>, <span class="hljs-string">'destroy'</span>);
}

LazyValue.prototype = {
  isLazyValue: <span class="hljs-literal">true</span>,
  parent: <span class="hljs-literal">null</span>, <span class="hljs-comment">// TODO: is parent even needed? could be modeled as a subscriber</span>
  children: <span class="hljs-literal">null</span>,
  observers: <span class="hljs-literal">null</span>,
  cache: NIL,
  valueFn: <span class="hljs-literal">null</span>,
  subscribers: <span class="hljs-literal">null</span>, <span class="hljs-comment">// TODO: do we need multiple subscribers?</span>
  _childValues: <span class="hljs-literal">null</span>, <span class="hljs-comment">// just for reusing the array, might not work well if children.length changes after computation</span>

  value: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">var</span> cache = <span class="hljs-keyword">this</span>.cache;
    <span class="hljs-keyword">if</span> (cache !== NIL) { <span class="hljs-keyword">return</span> cache; }

    <span class="hljs-keyword">var</span> children = <span class="hljs-keyword">this</span>.children;
    <span class="hljs-keyword">if</span> (children) {
      <span class="hljs-keyword">var</span> child,
          values = <span class="hljs-keyword">this</span>._childValues || <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(children.length);

      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, l = children.length; i &lt; l; i++) {
        child = children[i];
        values[i] = (child &amp;&amp; child.isLazyValue) ? child.value() : child;
      }

      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.cache = <span class="hljs-keyword">this</span>.valueFn(values);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.cache = <span class="hljs-keyword">this</span>.valueFn(EMPTY_ARRAY);
    }
  },

  set: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(key, value, options)</span></span>{
    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.context){
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.context.set(key, value, options);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
  },

  addDependentValue: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(value)</span> </span>{
    <span class="hljs-keyword">var</span> children = <span class="hljs-keyword">this</span>.children;
    <span class="hljs-keyword">if</span> (!children) {
      children = <span class="hljs-keyword">this</span>.children = [value];
    } <span class="hljs-keyword">else</span> {
      children.push(value);
    }

    <span class="hljs-keyword">if</span> (value &amp;&amp; value.isLazyValue) { value.parent = <span class="hljs-keyword">this</span>; }

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
  },

  addObserver: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(path, context)</span> </span>{
    <span class="hljs-keyword">var</span> observers = <span class="hljs-keyword">this</span>.observers || (<span class="hljs-keyword">this</span>.observers = []),
        position, res;

    <span class="hljs-keyword">if</span>(!_.isObject(context) || !_.isString(path)) <span class="hljs-keyword">return</span> <span class="hljs-built_in">console</span>.error(<span class="hljs-string">'Error adding observer for'</span>, context, path);</pre></div></div>
            
        </li>
        
        
        <li id="section-212">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-212">&#182;</a>
              </div>
              <p>Ensure _observers exists and is an object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    context.__observers = context.__observers || {};</pre></div></div>
            
        </li>
        
        
        <li id="section-213">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-213">&#182;</a>
              </div>
              <p>Ensure __observers[path] exists and is an array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    context.__observers[path] = context.__observers[path] || {collection: [], model: []};</pre></div></div>
            
        </li>
        
        
        <li id="section-214">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-214">&#182;</a>
              </div>
              <p>Save the type of object events this observer is for</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    res = context.get(<span class="hljs-keyword">this</span>.path);
    res = (res &amp;&amp; res.isCollection) ? <span class="hljs-string">'collection'</span> : <span class="hljs-string">'model'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-215">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-215">&#182;</a>
              </div>
              <p>Add our callback, save the position it is being inserted so we can garbage collect later.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    position = context.__observers[path][res].push(<span class="hljs-keyword">this</span>) - <span class="hljs-number">1</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-216">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-216">&#182;</a>
              </div>
              <p>Lazyvalue needs referance to its observers to remove listeners on destroy</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    observers.push({context: context, path: path, index: position});

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
  },

  notify: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(sender)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-217">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-217">&#182;</a>
              </div>
              <p>TODO: This check won’t be necessary once removed DOM has been cleaned of any bindings.
If this lazyValue’s morph does not have an immediate parentNode, it has been removed from the dom tree. Destroy it.
Right now, DOM that contains morphs throw an error if it is removed by another lazyvalue before those morphs re-evaluate.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.morph &amp;&amp; <span class="hljs-keyword">this</span>.morph.firstNode &amp;&amp; !<span class="hljs-keyword">this</span>.morph.firstNode.parentNode) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.destroy();
    <span class="hljs-keyword">var</span> cache = <span class="hljs-keyword">this</span>.cache,
        parent,
        subscribers;

    <span class="hljs-keyword">if</span> (cache !== NIL) {
      parent = <span class="hljs-keyword">this</span>.parent;
      subscribers = <span class="hljs-keyword">this</span>.subscribers;
      cache = <span class="hljs-keyword">this</span>.cache = NIL;
      <span class="hljs-keyword">if</span> (parent) { parent.notify(<span class="hljs-keyword">this</span>); }
      <span class="hljs-keyword">if</span> (!subscribers) { <span class="hljs-keyword">return</span>; }
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, l = subscribers.length; i &lt; l; i++) {
        subscribers[i](<span class="hljs-keyword">this</span>);
      }
    }
  },

  onNotify: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(callback)</span> </span>{
    <span class="hljs-keyword">var</span> subscribers = <span class="hljs-keyword">this</span>.subscribers || (<span class="hljs-keyword">this</span>.subscribers = []);
    subscribers.push(callback);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
  },

  destroy: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    _.each(<span class="hljs-keyword">this</span>.children, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(child)</span></span>{
      <span class="hljs-keyword">if</span> (child &amp;&amp; child.isLazyValue){ child.destroy(); }
    });
    _.each(<span class="hljs-keyword">this</span>.subscribers, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(subscriber)</span></span>{
      <span class="hljs-keyword">if</span> (subscriber &amp;&amp; subscriber.isLazyValue){ subscriber.destroy(); }
    });

    <span class="hljs-keyword">this</span>.parent = <span class="hljs-keyword">this</span>.children = <span class="hljs-keyword">this</span>.cache = <span class="hljs-keyword">this</span>.valueFn = <span class="hljs-keyword">this</span>.subscribers = <span class="hljs-keyword">this</span>._childValues = <span class="hljs-literal">null</span>;

    _.each(<span class="hljs-keyword">this</span>.observers, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(observer)</span></span>{
      <span class="hljs-keyword">if</span>(_.isObject(observer.context.__observers[observer.path])){
        <span class="hljs-keyword">delete</span> observer.context.__observers[observer.path][observer.index];
      }
    });

    <span class="hljs-keyword">this</span>.observers = <span class="hljs-literal">null</span>;
  }
};

export <span class="hljs-keyword">default</span> LazyValue;</pre></div></div>
            
        </li>
        
        
        <li id="section-218">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-218">&#182;</a>
              </div>
              <h2 id="rebound-router">Rebound Router</h2>

            </div>
            
        </li>
        
        
        <li id="section-219">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-219">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
import $ from <span class="hljs-string">"rebound-component/utils"</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-220">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-220">&#182;</a>
              </div>
              <p>If Backbone hasn’t been started yet, throw error</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">if</span>(!<span class="hljs-built_in">window</span>.Backbone){ <span class="hljs-keyword">throw</span> <span class="hljs-string">"Backbone must be on the page for Rebound to load."</span>; }</pre></div></div>
            
        </li>
        
        
        <li id="section-221">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-221">&#182;</a>
              </div>
              <p>Clean up old page component and load routes from our new page component</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">installResources</span><span class="hljs-params">(PageApp, primaryRoute, isGlobal)</span> </span>{
    <span class="hljs-keyword">var</span> oldPageName, pageInstance, container, router = <span class="hljs-keyword">this</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-222">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-222">&#182;</a>
              </div>
              <p>De-initialize the previous app before rendering a new app
This way we can ensure that every new page starts with a clean slate
This is crucial for scalability of a single page app.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span>(!isGlobal &amp;&amp; <span class="hljs-keyword">this</span>.current){

      oldPageName = <span class="hljs-keyword">this</span>.current.__name;</pre></div></div>
            
        </li>
        
        
        <li id="section-223">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-223">&#182;</a>
              </div>
              <p>Unset Previous Application’s Routes. For each route in the page app:</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      _.each(<span class="hljs-keyword">this</span>.current.__component__.routes, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(value, key)</span> </span>{

        <span class="hljs-keyword">var</span> regExp = router._routeToRegExp(key).toString();</pre></div></div>
            
        </li>
        
        
        <li id="section-224">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-224">&#182;</a>
              </div>
              <p>Remove the handler from our route object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        Backbone.history.handlers = _.filter(Backbone.history.handlers, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(obj)</span></span>{<span class="hljs-keyword">return</span> obj.route.toString() !== regExp;});</pre></div></div>
            
        </li>
        
        
        <li id="section-225">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-225">&#182;</a>
              </div>
              <p>Delete our referance to the route’s callback</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">delete</span> router[ <span class="hljs-string">'_function_'</span> + key ];

      });</pre></div></div>
            
        </li>
        
        
        <li id="section-226">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-226">&#182;</a>
              </div>
              <p>Un-hook Event Bindings, Delete Objects</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">this</span>.current.__component__.deinitialize();</pre></div></div>
            
        </li>
        
        
        <li id="section-227">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-227">&#182;</a>
              </div>
              <p>Disable old css if it exists</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
        <span class="hljs-built_in">document</span>.getElementById(oldPageName + <span class="hljs-string">'-css'</span>).setAttribute(<span class="hljs-string">'disabled'</span>, <span class="hljs-literal">true</span>);
      }, <span class="hljs-number">500</span>);

    }</pre></div></div>
            
        </li>
        
        
        <li id="section-228">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-228">&#182;</a>
              </div>
              <p>Load New PageApp, give it it’s name so we know what css to remove when it deinitializes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    pageInstance = <span class="hljs-keyword">new</span> PageApp();
    pageInstance.__name = primaryRoute;</pre></div></div>
            
        </li>
        
        
        <li id="section-229">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-229">&#182;</a>
              </div>
              <p>Add to our page</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    container = (isGlobal) ? <span class="hljs-built_in">document</span>.querySelector(isGlobal) : <span class="hljs-built_in">document</span>.getElementsByTagName(<span class="hljs-string">'content'</span>)[<span class="hljs-number">0</span>];
    container.innerHTML = <span class="hljs-string">''</span>;
    container.appendChild(pageInstance);</pre></div></div>
            
        </li>
        
        
        <li id="section-230">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-230">&#182;</a>
              </div>
              <p>Make sure we’re back at the top of the page</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-built_in">document</span>.body.scrollTop = <span class="hljs-number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-231">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-231">&#182;</a>
              </div>
              <p>Augment ApplicationRouter with new routes from PageApp</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    _.each(pageInstance.__component__.routes, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(value, key)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-232">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-232">&#182;</a>
              </div>
              <p>Generate our route callback’s new name</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> routeFunctionName = <span class="hljs-string">'_function_'</span> + key,
          functionName;</pre></div></div>
            
        </li>
        
        
        <li id="section-233">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-233">&#182;</a>
              </div>
              <p>Add the new callback referance on to our router</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      router[routeFunctionName] =  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{ pageInstance.__component__[value].apply(pageInstance.__component__, <span class="hljs-built_in">arguments</span>); };</pre></div></div>
            
        </li>
        
        
        <li id="section-234">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-234">&#182;</a>
              </div>
              <p>Add the route handler</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      router.route(key, value, <span class="hljs-keyword">this</span>[routeFunctionName]);
    }, <span class="hljs-keyword">this</span>);

    <span class="hljs-keyword">if</span>(!isGlobal){
      <span class="hljs-built_in">window</span>.Rebound.page = (<span class="hljs-keyword">this</span>.current = pageInstance).__component__;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-235">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-235">&#182;</a>
              </div>
              <p>Return our newly installed app</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">return</span> pageInstance;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-236">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-236">&#182;</a>
              </div>
              <p>Fetches Pare HTML and CSS</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fetchResources</span><span class="hljs-params">(appName, primaryRoute, isGlobal)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-237">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-237">&#182;</a>
              </div>
              <p>Expecting Module Definition as ‘SearchApp’ Where ‘Search’ a Primary Route</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> jsUrl = <span class="hljs-keyword">this</span>.config.jsPath.replace(<span class="hljs-regexp">/:route/g</span>, primaryRoute).replace(<span class="hljs-regexp">/:app/g</span>, appName),
        cssUrl = <span class="hljs-keyword">this</span>.config.cssPath.replace(<span class="hljs-regexp">/:route/g</span>, primaryRoute).replace(<span class="hljs-regexp">/:app/g</span>, appName),
        cssLoaded = <span class="hljs-literal">false</span>,
        jsLoaded = <span class="hljs-literal">false</span>,
        cssElement = <span class="hljs-built_in">document</span>.getElementById(appName + <span class="hljs-string">'-css'</span>),
        jsElement = <span class="hljs-built_in">document</span>.getElementById(appName + <span class="hljs-string">'-js'</span>),
        router = <span class="hljs-keyword">this</span>,
        PageApp;</pre></div></div>
            
        </li>
        
        
        <li id="section-238">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-238">&#182;</a>
              </div>
              <p>Only Load CSS If Not Loaded Before</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span>(!cssElement){
        cssElement = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'link'</span>);
        cssElement.setAttribute(<span class="hljs-string">'type'</span>, <span class="hljs-string">'text/css'</span>);
        cssElement.setAttribute(<span class="hljs-string">'rel'</span>, <span class="hljs-string">'stylesheet'</span>);
        cssElement.setAttribute(<span class="hljs-string">'href'</span>, cssUrl);
        cssElement.setAttribute(<span class="hljs-string">'id'</span>, appName + <span class="hljs-string">'-css'</span>);
        <span class="hljs-built_in">document</span>.head.appendChild(cssElement);
        $(cssElement).on(<span class="hljs-string">'load'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(event)</span></span>{
            <span class="hljs-keyword">if</span>((cssLoaded = <span class="hljs-literal">true</span>) &amp;&amp; jsLoaded){</pre></div></div>
            
        </li>
        
        
        <li id="section-239">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-239">&#182;</a>
              </div>
              <p>Install The Loaded Resources</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              installResources.call(router, PageApp, appName, isGlobal);</pre></div></div>
            
        </li>
        
        
        <li id="section-240">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-240">&#182;</a>
              </div>
              <p>Re-trigger route so the newly added route may execute if there’s a route match.
If no routes are matched, app will hit wildCard route which will then trigger 404</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              <span class="hljs-keyword">if</span>(!isGlobal &amp;&amp; router.config.triggerOnFirstLoad){
                Backbone.history.loadUrl(Backbone.history.fragment);
              }
              <span class="hljs-keyword">if</span>(!isGlobal){
                router.config.triggerOnFirstLoad = <span class="hljs-literal">true</span>;
              }
              <span class="hljs-built_in">document</span>.body.classList.remove(<span class="hljs-string">'loading'</span>);
            }
          });
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-241">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-241">&#182;</a>
              </div>
              <p>If it has been loaded bevore, enable it</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">else</span> {
        cssElement.removeAttribute(<span class="hljs-string">'disabled'</span>);
        cssLoaded = <span class="hljs-literal">true</span>;
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-242">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-242">&#182;</a>
              </div>
              <p>If if requirejs is not on the page, load the file manually. It better contain all its dependancies.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span>(<span class="hljs-built_in">window</span>.require._defined || _.isUndefined(<span class="hljs-built_in">window</span>.require)){
          jsElement = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">'script'</span>);
          jsElement.setAttribute(<span class="hljs-string">'type'</span>, <span class="hljs-string">'text/javascript'</span>);
          jsElement.setAttribute(<span class="hljs-string">'src'</span>, <span class="hljs-string">'/'</span>+jsUrl+<span class="hljs-string">'.js'</span>);
          jsElement.setAttribute(<span class="hljs-string">'id'</span>, appName + <span class="hljs-string">'-js'</span>);
          <span class="hljs-built_in">document</span>.head.appendChild(jsElement);
          $(jsElement).on(<span class="hljs-string">'load'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(event)</span></span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-243">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-243">&#182;</a>
              </div>
              <p>AMD Will Manage Dependancies For Us. Load The App.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-built_in">require</span>([jsUrl], <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(PageClass)</span></span>{

              <span class="hljs-keyword">if</span>((jsLoaded = <span class="hljs-literal">true</span>) &amp;&amp; (PageApp = PageClass) &amp;&amp; cssLoaded){</pre></div></div>
            
        </li>
        
        
        <li id="section-244">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-244">&#182;</a>
              </div>
              <p>Install The Loaded Resources</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                installResources.call(router, PageApp, appName, isGlobal);</pre></div></div>
            
        </li>
        
        
        <li id="section-245">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-245">&#182;</a>
              </div>
              <p>Re-trigger route so the newly added route may execute if there’s a route match.
If no routes are matched, app will hit wildCard route which will then trigger 404</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span>(!isGlobal &amp;&amp; router.config.triggerOnFirstLoad){
                  Backbone.history.loadUrl(Backbone.history.fragment);
                }
                <span class="hljs-keyword">if</span>(!isGlobal){
                  router.config.triggerOnFirstLoad = <span class="hljs-literal">true</span>;
                }

                <span class="hljs-built_in">document</span>.body.classList.remove(<span class="hljs-string">'loading'</span>);
              }
            });
          });

      }
      <span class="hljs-keyword">else</span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-246">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-246">&#182;</a>
              </div>
              <p>AMD Will Manage Dependancies For Us. Load The App.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-built_in">window</span>.require([jsUrl], <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(PageClass)</span></span>{

          <span class="hljs-keyword">if</span>((jsLoaded = <span class="hljs-literal">true</span>) &amp;&amp; (PageApp = PageClass) &amp;&amp; cssLoaded){</pre></div></div>
            
        </li>
        
        
        <li id="section-247">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-247">&#182;</a>
              </div>
              <p>Install The Loaded Resources</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            installResources.call(router, PageApp, appName, isGlobal);</pre></div></div>
            
        </li>
        
        
        <li id="section-248">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-248">&#182;</a>
              </div>
              <p>Re-trigger route so the newly added route may execute if there’s a route match.
If no routes are matched, app will hit wildCard route which will then trigger 404</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span>(!isGlobal &amp;&amp; router.config.triggerOnFirstLoad){
              Backbone.history.loadUrl(Backbone.history.fragment);
            }

            <span class="hljs-keyword">if</span>(!isGlobal){
              router.config.triggerOnFirstLoad = <span class="hljs-literal">true</span>;
            }
            <span class="hljs-built_in">document</span>.body.classList.remove(<span class="hljs-string">'loading'</span>);
          }
        });
      }

  }</pre></div></div>
            
        </li>
        
        
        <li id="section-249">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-249">&#182;</a>
              </div>
              <p>ReboundRouter Constructor</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> ReboundRouter = Backbone.Router.extend({

    routes: {
      <span class="hljs-string">'*route'</span>: <span class="hljs-string">'wildcardRoute'</span>
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-250">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-250">&#182;</a>
              </div>
              <p>Called when no matching routes are found. Extracts root route and fetches it resources</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    wildcardRoute: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(route)</span> </span>{
      <span class="hljs-keyword">var</span> appName, primaryRoute;</pre></div></div>
            
        </li>
        
        
        <li id="section-251">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-251">&#182;</a>
              </div>
              <p>If empty route sent, route home</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      route = route || <span class="hljs-string">''</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-252">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-252">&#182;</a>
              </div>
              <p>Get Root of Route</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      appName = primaryRoute = (route) ? route.split(<span class="hljs-string">'/'</span>)[<span class="hljs-number">0</span>] : <span class="hljs-string">'index'</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-253">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-253">&#182;</a>
              </div>
              <p>Find Any Custom Route Mappings</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      _.any(<span class="hljs-keyword">this</span>.config.handlers, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(handler)</span> </span>{
        <span class="hljs-keyword">if</span> (handler.route.test(route)) {
          appName = handler.primaryRoute;
          <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
      });</pre></div></div>
            
        </li>
        
        
        <li id="section-254">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-254">&#182;</a>
              </div>
              <p>If Page Is Already Loaded Then The Route Does Not Exist. 404 and Exit.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.current &amp;&amp; <span class="hljs-keyword">this</span>.current.name === primaryRoute) {
        <span class="hljs-keyword">return</span> Backbone.history.loadUrl(<span class="hljs-string">'404'</span>);
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-255">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-255">&#182;</a>
              </div>
              <p>Fetch Resources</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-built_in">document</span>.body.classList.add(<span class="hljs-string">"loading"</span>);
      fetchResources.call(<span class="hljs-keyword">this</span>, appName, primaryRoute);
    },</pre></div></div>
            
        </li>
        
        
        <li id="section-256">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-256">&#182;</a>
              </div>
              <p>On startup, save our config object and start the router</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    initialize: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(options)</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-257">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-257">&#182;</a>
              </div>
              <p>Save our config referance</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">this</span>.config = options.config;
      <span class="hljs-keyword">this</span>.config.handlers = [];

      <span class="hljs-keyword">var</span> remoteUrl = <span class="hljs-regexp">/^([a-z]+:)|^(\/\/)|^([^\/]+\.)/</span>,

      router = <span class="hljs-keyword">this</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-258">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-258">&#182;</a>
              </div>
              <p>Convert our routeMappings to regexps and push to our handlers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      _.each(<span class="hljs-keyword">this</span>.config.routeMapping, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(value, route)</span></span>{
        <span class="hljs-keyword">if</span> (!_.isRegExp(route)) route = router._routeToRegExp(route);
        router.config.handlers.unshift({ route: route, primaryRoute: value });
      }, <span class="hljs-keyword">this</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-259">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-259">&#182;</a>
              </div>
              <p>Navigate to route for any link with a relative href</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      $(<span class="hljs-built_in">document</span>).on(<span class="hljs-string">'click'</span>, <span class="hljs-string">'a'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span></span>{

        <span class="hljs-keyword">var</span> path = e.target.getAttribute(<span class="hljs-string">'href'</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-260">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-260">&#182;</a>
              </div>
              <p>If path is not an remote url, ends in .[a-z], or blank, try and navigate to that route.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span>( path &amp;&amp; path !== <span class="hljs-string">'#'</span> &amp;&amp; !remoteUrl.test(path) ){
          e.preventDefault();
          router.navigate(path, {trigger: <span class="hljs-literal">true</span>});
        }
      });</pre></div></div>
            
        </li>
        
        
        <li id="section-261">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-261">&#182;</a>
              </div>
              <p>Install our global components</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      _.each(<span class="hljs-keyword">this</span>.config.globalComponents, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(selector, route)</span></span>{
        fetchResources.call(router, route, route, selector);
      });</pre></div></div>
            
        </li>
        
        
        <li id="section-262">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-262">&#182;</a>
              </div>
              <p>Let all of our components always have referance to our router</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      Rebound.Component.prototype.router = <span class="hljs-keyword">this</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-263">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-263">&#182;</a>
              </div>
              <p>Start the history</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      Backbone.history.start({
        pushState: <span class="hljs-literal">true</span>,
        root: <span class="hljs-keyword">this</span>.config.root
      });

    }
  });

export <span class="hljs-keyword">default</span> ReboundRouter;</pre></div></div>
            
        </li>
        
        
        <li id="section-264">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-264">&#182;</a>
              </div>
              <h2 id="rebound-utils">Rebound Utils</h2>

            </div>
            
        </li>
        
        
        <li id="section-265">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-265">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-keyword">var</span> $ = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(query)</span></span>{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> utils(query);
};

<span class="hljs-keyword">var</span> utils = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(query)</span></span>{
  <span class="hljs-keyword">var</span> i, selector = _.isElement(query) &amp;&amp; [query] || (query === <span class="hljs-built_in">document</span>) &amp;&amp; [<span class="hljs-built_in">document</span>] || _.isString(query) &amp;&amp; querySelectorAll(query) || [];
  <span class="hljs-keyword">this</span>.length = selector.length;</pre></div></div>
            
        </li>
        
        
        <li id="section-266">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-266">&#182;</a>
              </div>
              <p>Add selector to object for method chaining</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">for</span> (i=<span class="hljs-number">0</span>; i &lt; <span class="hljs-keyword">this</span>.length; i++) {
      <span class="hljs-keyword">this</span>[i] = selector[i];
  }

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">returnFalse</span><span class="hljs-params">()</span></span>{<span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">returnTrue</span><span class="hljs-params">()</span></span>{<span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;}

$.Event = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">( src, props )</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-267">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-267">&#182;</a>
              </div>
              <p>Allow instantiation without the ‘new’ keyword</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">if</span> ( !(<span class="hljs-keyword">this</span> <span class="hljs-keyword">instanceof</span> $.Event) ) {
		<span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> $.Event( src, props );
	}</pre></div></div>
            
        </li>
        
        
        <li id="section-268">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-268">&#182;</a>
              </div>
              <p>Event object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">if</span> ( src &amp;&amp; src.type ) {
		<span class="hljs-keyword">this</span>.originalEvent = src;
		<span class="hljs-keyword">this</span>.type = src.type;</pre></div></div>
            
        </li>
        
        
        <li id="section-269">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-269">&#182;</a>
              </div>
              <p>Events bubbling up the document may have been marked as prevented
by a handler lower down the tree; reflect the correct value.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>		<span class="hljs-keyword">this</span>.isDefaultPrevented = src.defaultPrevented ||
				src.defaultPrevented === <span class="hljs-literal">undefined</span> &amp;&amp;</pre></div></div>
            
        </li>
        
        
        <li id="section-270">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-270">&#182;</a>
              </div>
              <p>Support: Android&lt;4.0</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>				src.returnValue === <span class="hljs-literal">false</span> ?
			returnTrue :
			returnFalse;</pre></div></div>
            
        </li>
        
        
        <li id="section-271">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-271">&#182;</a>
              </div>
              <p>Event type</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	} <span class="hljs-keyword">else</span> {
		<span class="hljs-keyword">this</span>.type = src;
	}</pre></div></div>
            
        </li>
        
        
        <li id="section-272">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-272">&#182;</a>
              </div>
              <p>Put explicitly provided properties onto the event object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">if</span> ( props ) {
		_.extend( <span class="hljs-keyword">this</span>, props );
	}</pre></div></div>
            
        </li>
        
        
        <li id="section-273">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-273">&#182;</a>
              </div>
              <p>Copy over all original event properties</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _.extend(<span class="hljs-keyword">this</span>, _.pick( <span class="hljs-keyword">this</span>.originalEvent, [
      <span class="hljs-string">"altKey"</span>, <span class="hljs-string">"bubbles"</span>, <span class="hljs-string">"cancelable"</span>, <span class="hljs-string">"ctrlKey"</span>, <span class="hljs-string">"currentTarget"</span>, <span class="hljs-string">"eventPhase"</span>,
      <span class="hljs-string">"metaKey"</span>, <span class="hljs-string">"relatedTarget"</span>, <span class="hljs-string">"shiftKey"</span>, <span class="hljs-string">"target"</span>, <span class="hljs-string">"timeStamp"</span>, <span class="hljs-string">"view"</span>,
      <span class="hljs-string">"which"</span>, <span class="hljs-string">"char"</span>, <span class="hljs-string">"charCode"</span>, <span class="hljs-string">"key"</span>, <span class="hljs-string">"keyCode"</span>, <span class="hljs-string">"button"</span>, <span class="hljs-string">"buttons"</span>,
      <span class="hljs-string">"clientX"</span>, <span class="hljs-string">"clientY"</span>, <span class="hljs-string">""</span>, <span class="hljs-string">"offsetX"</span>, <span class="hljs-string">"offsetY"</span>, <span class="hljs-string">"pageX"</span>, <span class="hljs-string">"pageY"</span>, <span class="hljs-string">"screenX"</span>,
      <span class="hljs-string">"screenY"</span>, <span class="hljs-string">"toElement"</span>
    ]));</pre></div></div>
            
        </li>
        
        
        <li id="section-274">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-274">&#182;</a>
              </div>
              <p>Create a timestamp if incoming event doesn’t have one</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">this</span>.timeStamp = src &amp;&amp; src.timeStamp || (<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>()).getTime();</pre></div></div>
            
        </li>
        
        
        <li id="section-275">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-275">&#182;</a>
              </div>
              <p>Mark it as fixed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">this</span>.isEvent = <span class="hljs-literal">true</span>;
};

$.Event.prototype = {
	constructor: $.Event,
	isDefaultPrevented: returnFalse,
	isPropagationStopped: returnFalse,
	isImmediatePropagationStopped: returnFalse,

	preventDefault: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
		<span class="hljs-keyword">var</span> e = <span class="hljs-keyword">this</span>.originalEvent;

		<span class="hljs-keyword">this</span>.isDefaultPrevented = returnTrue;

		<span class="hljs-keyword">if</span> ( e &amp;&amp; e.preventDefault ) {
			e.preventDefault();
		}
	},
	stopPropagation: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
		<span class="hljs-keyword">var</span> e = <span class="hljs-keyword">this</span>.originalEvent;

		<span class="hljs-keyword">this</span>.isPropagationStopped = returnTrue;

		<span class="hljs-keyword">if</span> ( e &amp;&amp; e.stopPropagation ) {
			e.stopPropagation();
		}
	},
	stopImmediatePropagation: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
		<span class="hljs-keyword">var</span> e = <span class="hljs-keyword">this</span>.originalEvent;

		<span class="hljs-keyword">this</span>.isImmediatePropagationStopped = returnTrue;

		<span class="hljs-keyword">if</span> ( e &amp;&amp; e.stopImmediatePropagation ) {
			e.stopImmediatePropagation();
		}

		<span class="hljs-keyword">this</span>.stopPropagation();
	}
};


utils.prototype = {</pre></div></div>
            
        </li>
        
        
        <li id="section-276">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-276">&#182;</a>
              </div>
              <p>Given a valid data path, split it into an array of its parts.
ex: foo.bar[0].baz —&gt; [‘foo’, ‘var’, ‘0’, ‘baz’]</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  splitPath: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(path)</span></span>{
    path = (<span class="hljs-string">'.'</span>+path+<span class="hljs-string">'.'</span>).split(<span class="hljs-regexp">/(?:\.|\[|\])+/</span>);
    path.pop();
    path.shift();
    <span class="hljs-keyword">return</span> path;
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-277">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-277">&#182;</a>
              </div>
              <p>Applies function <code>func</code> depth first to every node in the subtree starting from <code>root</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  walkTheDOM: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(func)</span> </span>{
    <span class="hljs-keyword">var</span> el, root, len = <span class="hljs-keyword">this</span>.length;
    <span class="hljs-keyword">while</span>(len--){
      root = <span class="hljs-keyword">this</span>[len];
      func(root);
      root = root.firstChild;
      <span class="hljs-keyword">while</span> (root) {
          $(root).walkTheDOM(func);
          root = root.nextSibling;
      }
    }
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-278">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-278">&#182;</a>
              </div>
              <p>Events registry. An object containing all events bound through this util shared among all instances.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _events: {},</pre></div></div>
            
        </li>
        
        
        <li id="section-279">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-279">&#182;</a>
              </div>
              <p>Takes the targed the event fired on and returns all callbacks for the delegated element</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _hasDelegate: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(target, delegate, eventType)</span></span>{
    <span class="hljs-keyword">var</span> callbacks = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-280">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-280">&#182;</a>
              </div>
              <p>Get our callbacks</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span>(target.delegateGroup &amp;&amp; <span class="hljs-keyword">this</span>._events[target.delegateGroup][eventType]){
      _.each(<span class="hljs-keyword">this</span>._events[target.delegateGroup][eventType], <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(callbacksList, delegateId)</span></span>{
        <span class="hljs-keyword">if</span>(_.isArray(callbacksList) &amp;&amp; (delegateId === delegate.delegateId || ( delegate.matchesSelector &amp;&amp; delegate.matchesSelector(delegateId) )) ){
          callbacks = callbacks.concat(callbacksList);
        }
      });
    }

    <span class="hljs-keyword">return</span> callbacks;
  },</pre></div></div>
            
        </li>
        
        
        <li id="section-281">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-281">&#182;</a>
              </div>
              <p>Triggers an event on a given dom node</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  trigger: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(eventName, options)</span></span>{
    <span class="hljs-keyword">var</span> el, len = <span class="hljs-keyword">this</span>.length;
    <span class="hljs-keyword">while</span>(len--){
      el = <span class="hljs-keyword">this</span>[len];
      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">document</span>.createEvent) {
        <span class="hljs-keyword">var</span> event = <span class="hljs-built_in">document</span>.createEvent(<span class="hljs-string">'HTMLEvents'</span>);
        event.initEvent(eventName, <span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>);
        el.dispatchEvent(event);
      } <span class="hljs-keyword">else</span> {
        el.fireEvent(<span class="hljs-string">'on'</span>+eventName);
      }
    }
  },

  off: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(eventType, handler)</span></span>{
    <span class="hljs-keyword">var</span> el, len = <span class="hljs-keyword">this</span>.length, eventCount;

    <span class="hljs-keyword">while</span>(len--){

      el = <span class="hljs-keyword">this</span>[len];
      eventCount = <span class="hljs-number">0</span>;

      <span class="hljs-keyword">if</span>(el.delegateGroup){
        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>._events[el.delegateGroup][eventType] &amp;&amp; _.isArray(<span class="hljs-keyword">this</span>._events[el.delegateGroup][eventType][el.delegateId])){
          _.each(<span class="hljs-keyword">this</span>._events[el.delegateGroup][eventType], <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(delegate, index, delegateList)</span></span>{
            _.each(delegateList, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(callback, index, callbackList)</span></span>{
              <span class="hljs-keyword">if</span>(callback === handler){
                <span class="hljs-keyword">delete</span> callbackList[index];
                <span class="hljs-keyword">return</span>;
              }
              eventCount++;
            });
          });
        }
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-282">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-282">&#182;</a>
              </div>
              <p>If there are no more of this event type delegated for this group, remove the listener</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (eventCount === <span class="hljs-number">0</span> &amp;&amp; el.removeEventListener){
        el.removeEventListener(eventType, handler, <span class="hljs-literal">false</span>);
      }
      <span class="hljs-keyword">if</span> (eventCount === <span class="hljs-number">0</span> &amp;&amp; el.detachEvent){
        el.detachEvent(<span class="hljs-string">'on'</span>+eventType, handler);
      }

    }
  },

  on: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(eventName, delegate, data, handler)</span> </span>{
    <span class="hljs-keyword">var</span> el,
        events = <span class="hljs-keyword">this</span>._events,
        len = <span class="hljs-keyword">this</span>.length,
        eventNames = eventName.split(<span class="hljs-string">' '</span>),
        delegateId, delegateGroup;

    <span class="hljs-keyword">while</span>(len--){
      el = <span class="hljs-keyword">this</span>[len];</pre></div></div>
            
        </li>
        
        
        <li id="section-283">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-283">&#182;</a>
              </div>
              <p>Normalize data input</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span>(_.isFunction(delegate)){
        handler = delegate;
        delegate = el;
        data = {};
      }
      <span class="hljs-keyword">if</span>(_.isFunction(data)){
        handler = data;
        data = {};
      }
      <span class="hljs-keyword">if</span>(!_.isString(delegate) &amp;&amp; !_.isElement(delegate)){
        <span class="hljs-built_in">console</span>.error(<span class="hljs-string">"Delegate value passed to Rebound's $.on is neither an element or css selector"</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
      }

      delegateId = _.isString(delegate) ? delegate : (delegate.delegateId = delegate.delegateId || _.uniqueId(<span class="hljs-string">'event'</span>));
      delegateGroup = el.delegateGroup = (el.delegateGroup || _.uniqueId(<span class="hljs-string">'delegateGroup'</span>));

      _.each(eventNames, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(eventName)</span></span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-284">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-284">&#182;</a>
              </div>
              <p>Ensure event obj existance</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        events[delegateGroup] = events[delegateGroup] || {};</pre></div></div>
            
        </li>
        
        
        <li id="section-285">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-285">&#182;</a>
              </div>
              <p>TODO: take out of loop</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">var</span> callback = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(event)</span></span>{
              <span class="hljs-keyword">var</span> target, i, len, eventList, callbacks, callback, falsy;
              event = <span class="hljs-keyword">new</span> $.Event((event || <span class="hljs-built_in">window</span>.event)); <span class="hljs-comment">// Convert to mutable event</span>
              target = event.target || event.srcElement;</pre></div></div>
            
        </li>
        
        
        <li id="section-286">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-286">&#182;</a>
              </div>
              <p>Travel from target up to parent firing event on delegate when it exizts</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              <span class="hljs-keyword">while</span>(target){</pre></div></div>
            
        </li>
        
        
        <li id="section-287">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-287">&#182;</a>
              </div>
              <p>Get all specified callbacks (element specific and selector specified)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                callbacks = $._hasDelegate(el, target, event.type);

                len = callbacks.length;
                <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>;i&lt;len;i++){
                  event.target = event.srcElement = target;               <span class="hljs-comment">// Attach this level's target</span>
                  event.data = callbacks[i].data;                         <span class="hljs-comment">// Attach our data to the event</span>
                  event.result = callbacks[i].callback.call(el, event);   <span class="hljs-comment">// Call the callback</span>
                  falsy = ( event.result === <span class="hljs-literal">false</span> ) ? <span class="hljs-literal">true</span> : falsy;      <span class="hljs-comment">// If any callback returns false, log it as falsy</span>
                }</pre></div></div>
            
        </li>
        
        
        <li id="section-288">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-288">&#182;</a>
              </div>
              <p>If any of the callbacks returned false, prevent default and stop propagation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>                <span class="hljs-keyword">if</span>(falsy){
                  event.preventDefault();
                  event.stopPropagation();
                  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                }

                target = target.parentNode;
              }
            };</pre></div></div>
            
        </li>
        
        
        <li id="section-289">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-289">&#182;</a>
              </div>
              <p>If this is the first event of its type, add the event handler
AddEventListener supports IE9+</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span>(!events[delegateGroup][eventName]){</pre></div></div>
            
        </li>
        
        
        <li id="section-290">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-290">&#182;</a>
              </div>
              <p>If event is focus or blur, use capture to allow for event delegation.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          el.addEventListener(eventName, callback, (eventName === <span class="hljs-string">'focus'</span> || eventName === <span class="hljs-string">'blur'</span>));
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-291">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-291">&#182;</a>
              </div>
              <p>Add our listener</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        events[delegateGroup][eventName] = events[delegateGroup][eventName] || {};
        events[delegateGroup][eventName][delegateId] = events[delegateGroup][eventName][delegateId] || [];
        events[delegateGroup][eventName][delegateId].push({callback: handler, data: data});

      }, <span class="hljs-keyword">this</span>);
    }
  },

  flatten: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span> </span>{
    <span class="hljs-keyword">var</span> result = {};
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">recurse</span> <span class="hljs-params">(cur, prop)</span> </span>{
      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Object</span>(cur) !== cur) {
        result[prop] = cur;
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Array</span>.isArray(cur)) {
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>, l=cur.length; i&lt;l; i++)
          recurse(cur[i], prop + <span class="hljs-string">"["</span> + i + <span class="hljs-string">"]"</span>);
          <span class="hljs-keyword">if</span> (l === <span class="hljs-number">0</span>)
            result[prop] = [];
          } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">var</span> isEmpty = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> p <span class="hljs-keyword">in</span> cur) {
              isEmpty = <span class="hljs-literal">false</span>;
              recurse(cur[p], prop ? prop+<span class="hljs-string">"."</span>+p : p);
            }
            <span class="hljs-keyword">if</span> (isEmpty &amp;&amp; prop)
              result[prop] = {};
            }
          }
          recurse(data, <span class="hljs-string">""</span>);
          <span class="hljs-keyword">return</span> result;
        },</pre></div></div>
            
        </li>
        
        
        <li id="section-292">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-292">&#182;</a>
              </div>
              <p><a href="http://krasimirtsonev.com/blog/article/Cross-browser-handling-of-Ajax-requests-in-absurdjs">http://krasimirtsonev.com/blog/article/Cross-browser-handling-of-Ajax-requests-in-absurdjs</a></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  ajax: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(ops)</span> </span>{
      <span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> ops == <span class="hljs-string">'string'</span>) ops = { url: ops };
      ops.url = ops.url || <span class="hljs-string">''</span>;
      ops.json = ops.json || <span class="hljs-literal">true</span>;
      ops.method = ops.method || <span class="hljs-string">'get'</span>;
      ops.data = ops.data || {};
      <span class="hljs-keyword">var</span> getParams = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data, url)</span> </span>{
          <span class="hljs-keyword">var</span> arr = [], str;
          <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> name <span class="hljs-keyword">in</span> data) {
              arr.push(name + <span class="hljs-string">'='</span> + <span class="hljs-built_in">encodeURIComponent</span>(data[name]));
          }
          str = arr.join(<span class="hljs-string">'&amp;'</span>);
          <span class="hljs-keyword">if</span>(str !== <span class="hljs-string">''</span>) {
              <span class="hljs-keyword">return</span> url ? (url.indexOf(<span class="hljs-string">'?'</span>) &lt; <span class="hljs-number">0</span> ? <span class="hljs-string">'?'</span> + str : <span class="hljs-string">'&amp;'</span> + str) : str;
          }
          <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;
      };
      <span class="hljs-keyword">var</span> api = {
          host: {},
          process: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(ops)</span> </span>{
              <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
              <span class="hljs-keyword">this</span>.xhr = <span class="hljs-literal">null</span>;
              <span class="hljs-keyword">if</span>(<span class="hljs-built_in">window</span>.ActiveXObject) { <span class="hljs-keyword">this</span>.xhr = <span class="hljs-keyword">new</span> ActiveXObject(<span class="hljs-string">'Microsoft.XMLHTTP'</span>); }
              <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-built_in">window</span>.XMLHttpRequest) { <span class="hljs-keyword">this</span>.xhr = <span class="hljs-keyword">new</span> XMLHttpRequest(); }
              <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.xhr) {
                  <span class="hljs-keyword">this</span>.xhr.onreadystatechange = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
                      <span class="hljs-keyword">if</span>(self.xhr.readyState == <span class="hljs-number">4</span> &amp;&amp; self.xhr.status == <span class="hljs-number">200</span>) {
                          <span class="hljs-keyword">var</span> result = self.xhr.responseText;
                          <span class="hljs-keyword">if</span>(ops.json === <span class="hljs-literal">true</span> &amp;&amp; <span class="hljs-keyword">typeof</span> <span class="hljs-built_in">JSON</span> != <span class="hljs-string">'undefined'</span>) {
                              result = <span class="hljs-built_in">JSON</span>.parse(result);
                          }
                          self.doneCallback &amp;&amp; self.doneCallback.apply(self.host, [result, self.xhr]);
                          ops.success &amp;&amp; ops.success.apply(self.host, [result, self.xhr]);
                      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(self.xhr.readyState == <span class="hljs-number">4</span>) {
                          self.failCallback &amp;&amp; self.failCallback.apply(self.host, [self.xhr]);
                          ops.error &amp;&amp; ops.error.apply(self.host, [self.xhr]);
                      }
                      self.alwaysCallback &amp;&amp; self.alwaysCallback.apply(self.host, [self.xhr]);
                      ops.complete &amp;&amp; ops.complete.apply(self.host, [self.xhr]);
                  };
              }
              <span class="hljs-keyword">if</span>(ops.method == <span class="hljs-string">'get'</span>) {
                  <span class="hljs-keyword">this</span>.xhr.open(<span class="hljs-string">"GET"</span>, ops.url + getParams(ops.data, ops.url), <span class="hljs-literal">true</span>);
                  <span class="hljs-keyword">this</span>.setHeaders({
                    <span class="hljs-string">'X-Requested-With'</span>: <span class="hljs-string">'XMLHttpRequest'</span>
                  });
              } <span class="hljs-keyword">else</span> {
                  <span class="hljs-keyword">this</span>.xhr.open(ops.method, ops.url, <span class="hljs-literal">true</span>);
                  <span class="hljs-keyword">this</span>.setHeaders({
                      <span class="hljs-string">'X-Requested-With'</span>: <span class="hljs-string">'XMLHttpRequest'</span>,
                      <span class="hljs-string">'Content-type'</span>: <span class="hljs-string">'application/x-www-form-urlencoded'</span>
                  });
              }
              <span class="hljs-keyword">if</span>(ops.headers &amp;&amp; <span class="hljs-keyword">typeof</span> ops.headers == <span class="hljs-string">'object'</span>) {
                  <span class="hljs-keyword">this</span>.setHeaders(ops.headers);
              }
              setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
                  ops.method == <span class="hljs-string">'get'</span> ? self.xhr.send() : self.xhr.send(getParams(ops.data));
              }, <span class="hljs-number">20</span>);
              <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.xhr;
          },
          done: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(callback)</span> </span>{
              <span class="hljs-keyword">this</span>.doneCallback = callback;
              <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
          },
          fail: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(callback)</span> </span>{
              <span class="hljs-keyword">this</span>.failCallback = callback;
              <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
          },
          always: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(callback)</span> </span>{
              <span class="hljs-keyword">this</span>.alwaysCallback = callback;
              <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
          },
          setHeaders: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(headers)</span> </span>{
              <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> name <span class="hljs-keyword">in</span> headers) {
                  <span class="hljs-keyword">this</span>.xhr &amp;&amp; <span class="hljs-keyword">this</span>.xhr.setRequestHeader(name, headers[name]);
              }
          }
      };
      <span class="hljs-keyword">return</span> api.process(ops);
  }
};

_.extend($, utils.prototype);



export <span class="hljs-keyword">default</span> $;</pre></div></div>
            
        </li>
        
        
        <li id="section-293">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-293">&#182;</a>
              </div>
              <h2 id="property-compiler">Property Compiler</h2>

            </div>
            
        </li>
        
        
        <li id="section-294">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-294">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
import tokenizer from <span class="hljs-string">"property-compiler/tokenizer"</span>;

<span class="hljs-keyword">var</span> computedProperties = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-295">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-295">&#182;</a>
              </div>
              <p>TODO: Make this farrrrrr more robust…very minimal right now</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">compile</span><span class="hljs-params">(prop, name)</span></span>{
  <span class="hljs-keyword">var</span> output = {};

  <span class="hljs-keyword">if</span>(prop.__params) <span class="hljs-keyword">return</span> prop.__params;

  <span class="hljs-keyword">var</span> str = prop.toString(), <span class="hljs-comment">//.replace(/(?:\/\*(?:[\s\S]*?)\*\/)|(?:([\s;])+\/\/(?:.*)$)/gm, '$1'), // String representation of function sans comments</span>
      nextToken = tokenizer.tokenize(str),
      tokens = [],
      token,
      finishedPaths = [],
      namedPaths = {},
      opcodes = [],
      named = <span class="hljs-literal">false</span>,
      listening = <span class="hljs-number">0</span>,
      inSubComponent = <span class="hljs-number">0</span>,
      subComponent = [],
      root,
      paths = [],
      path,
      tmpPath,
      attrs = [],
      workingpath = [],
      terminators = [<span class="hljs-string">';'</span>,<span class="hljs-string">','</span>,<span class="hljs-string">'=='</span>,<span class="hljs-string">'&gt;'</span>,<span class="hljs-string">'&lt;'</span>,<span class="hljs-string">'&gt;='</span>,<span class="hljs-string">'&lt;='</span>,<span class="hljs-string">'&gt;=='</span>,<span class="hljs-string">'&lt;=='</span>,<span class="hljs-string">'!='</span>,<span class="hljs-string">'!=='</span>, <span class="hljs-string">'==='</span>, <span class="hljs-string">'&amp;&amp;'</span>, <span class="hljs-string">'||'</span>, <span class="hljs-string">'+'</span>, <span class="hljs-string">'-'</span>, <span class="hljs-string">'/'</span>, <span class="hljs-string">'*'</span>, <span class="hljs-string">'{'</span>, <span class="hljs-string">'}'</span>];
  <span class="hljs-keyword">do</span>{

    token = nextToken();

    <span class="hljs-keyword">if</span>(token.value === <span class="hljs-string">'this'</span>){
      listening++;
      workingpath = [];
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-296">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-296">&#182;</a>
              </div>
              <p>TODO: handle gets on collections</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span>(token.value === <span class="hljs-string">'get'</span>){
      path = nextToken();
      <span class="hljs-keyword">while</span>(_.isUndefined(path.value)){
        path = nextToken();
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-297">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-297">&#182;</a>
              </div>
              <p>Replace any access to a collection with the generic @each placeholder and push dependancy</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      workingpath.push(path.value.replace(<span class="hljs-regexp">/\[.+\]/g</span>, <span class="hljs-string">".@each"</span>).replace(<span class="hljs-regexp">/^\./</span>, <span class="hljs-string">''</span>));
    }

    <span class="hljs-keyword">if</span>(token.value === <span class="hljs-string">'pluck'</span>){
      path = nextToken();
      <span class="hljs-keyword">while</span>(_.isUndefined(path.value)){
        path = nextToken();
      }

      workingpath.push(<span class="hljs-string">'@each.'</span> + path.value);
    }

    <span class="hljs-keyword">if</span>(token.value === <span class="hljs-string">'slice'</span> || token.value === <span class="hljs-string">'clone'</span> || token.value === <span class="hljs-string">'filter'</span>){
      path = nextToken();
      <span class="hljs-keyword">if</span>(path.type.type === <span class="hljs-string">'('</span>) workingpath.push(<span class="hljs-string">'@each'</span>);
    }

    <span class="hljs-keyword">if</span>(token.value === <span class="hljs-string">'at'</span>){

      path = nextToken();
      <span class="hljs-keyword">while</span>(_.isUndefined(path.value)){
        path = nextToken();
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-298">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-298">&#182;</a>
              </div>
              <p>workingpath[workingpath.length -1] = workingpath[workingpath.length -1] + ‘[‘ + path.value + ‘]’;
workingpath.push(‘[‘ + path.value + ‘]’);</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      workingpath.push(<span class="hljs-string">'@each'</span>);

    }

    <span class="hljs-keyword">if</span>(token.value === <span class="hljs-string">'where'</span> || token.value === <span class="hljs-string">'findWhere'</span>){
      workingpath.push(<span class="hljs-string">'@each'</span>);
      path = nextToken();
      attrs = [];
      <span class="hljs-keyword">var</span> itr = <span class="hljs-number">0</span>;
      <span class="hljs-keyword">while</span>(path.type.type !== <span class="hljs-string">')'</span>){
        <span class="hljs-keyword">if</span>(path.value){
          <span class="hljs-keyword">if</span>(itr%<span class="hljs-number">2</span> === <span class="hljs-number">0</span>){
            attrs.push(path.value);
          }
          itr++;
        }
        path = nextToken();
      }
      workingpath.push(attrs);
    }

    <span class="hljs-keyword">if</span>(listening &amp;&amp; (_.indexOf(terminators, token.type.type) &gt; -<span class="hljs-number">1</span> || _.indexOf(terminators, token.value) &gt; -<span class="hljs-number">1</span>)){
      workingpath = _.reduce(workingpath, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(memo, paths)</span></span>{
        <span class="hljs-keyword">var</span> newMemo = [];
        paths = (!_.isArray(paths)) ? [paths] : paths;
        _.each(paths, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(path)</span></span>{
          _.each(memo, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(mem)</span></span>{
            newMemo.push(_.compact([mem, path]).join(<span class="hljs-string">'.'</span>).replace(<span class="hljs-string">'.['</span>, <span class="hljs-string">'['</span>));
          });
        });
        <span class="hljs-keyword">return</span> newMemo;
      }, [<span class="hljs-string">''</span>]);
      finishedPaths = _.compact(_.union(finishedPaths, workingpath));
      workingpath = [];
      listening--;
    }

  } <span class="hljs-keyword">while</span>(token.start !== token.end);

  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'COMPUTED PROPERTY'</span>, name, <span class="hljs-string">'registered with these dependancy paths:'</span>, finishedPaths);</pre></div></div>
            
        </li>
        
        
        <li id="section-299">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-299">&#182;</a>
              </div>
              <p>Return the dependancies list</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">return</span> prop.__params = finishedPaths;

}

export <span class="hljs-keyword">default</span> { compile: compile };</pre></div></div>
            
        </li>
        
        
        <li id="section-300">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-300">&#182;</a>
              </div>
              <h2 id="rebound-compiler">Rebound Compiler</h2>

            </div>
            
        </li>
        
        
        <li id="section-301">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-301">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
import { compile as htmlbarsCompile, compileSpec as htmlbarsCompileSpec } from <span class="hljs-string">"htmlbars-compiler/compiler"</span>;
import { merge } from <span class="hljs-string">"htmlbars-util/object-utils"</span>;
import DOMHelper from <span class="hljs-string">"dom-helper"</span>;
import helpers from <span class="hljs-string">"rebound-component/helpers"</span>;
import hooks from <span class="hljs-string">"rebound-component/hooks"</span>;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">compile</span><span class="hljs-params">(string, options)</span></span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-302">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-302">&#182;</a>
              </div>
              <p>Ensure we have a well-formed object as var options</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  options = options || {};
  options.helpers = options.helpers || {};
  options.hooks = options.hooks || {};</pre></div></div>
            
        </li>
        
        
        <li id="section-303">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-303">&#182;</a>
              </div>
              <p>Merge our default helpers with user provided helpers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  options.helpers = merge(helpers, options.helpers);
  options.hooks = merge(hooks, options.hooks);</pre></div></div>
            
        </li>
        
        
        <li id="section-304">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-304">&#182;</a>
              </div>
              <p>Compile our template function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> func = htmlbarsCompile(string, {
    helpers: options.helpers,
    hooks: options.hooks
  });

  func._render = func.render;</pre></div></div>
            
        </li>
        
        
        <li id="section-305">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-305">&#182;</a>
              </div>
              <p>Return a wrapper function that will merge user provided helpers with our defaults</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  func.render = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data, env, context)</span></span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-306">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-306">&#182;</a>
              </div>
              <p>Ensure we have a well-formed object as var options</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    env = env || {};
    env.helpers = env.helpers || {};
    env.hooks = env.hooks || {};
    env.dom = env.dom || <span class="hljs-keyword">new</span> DOMHelper();</pre></div></div>
            
        </li>
        
        
        <li id="section-307">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-307">&#182;</a>
              </div>
              <p>Merge our default helpers and hooks with user provided helpers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    env.helpers = merge(helpers, env.helpers);
    env.hooks = merge(hooks, env.hooks);</pre></div></div>
            
        </li>
        
        
        <li id="section-308">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-308">&#182;</a>
              </div>
              <p>Set a default context if it doesn’t exist</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    context = context || <span class="hljs-built_in">document</span>.body;</pre></div></div>
            
        </li>
        
        
        <li id="section-309">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-309">&#182;</a>
              </div>
              <p>Call our func with merged helpers and hooks</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">return</span> func._render(data, env, context);
  };

  helpers.registerPartial( options.name, func);

  <span class="hljs-keyword">return</span> func;

}

export { compile };</pre></div></div>
            
        </li>
        
        
        <li id="section-310">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-310">&#182;</a>
              </div>
              <h2 id="rebound-precompiler">Rebound Precompiler</h2>

            </div>
            
        </li>
        
        
        <li id="section-311">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-311">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>
import { compile as htmlbarsCompile, compileSpec as htmlbarsCompileSpec } from <span class="hljs-string">"htmlbars"</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-312">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-312">&#182;</a>
              </div>
              <p>Remove the contents of the component’s <code>script</code> tag.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getScript</span><span class="hljs-params">(str)</span></span>{
  <span class="hljs-keyword">return</span> (str.indexOf(<span class="hljs-string">'&lt;script&gt;'</span>) &gt; -<span class="hljs-number">1</span> &amp;&amp; str.indexOf(<span class="hljs-string">'&lt;/script&gt;'</span>) &gt; -<span class="hljs-number">1</span>) ? <span class="hljs-string">'(function(){'</span> + str.replace(<span class="hljs-regexp">/(.*&lt;script&gt;)(.*)(&lt;\/script&gt;.*)/ig</span>, <span class="hljs-string">'$2'</span>) + <span class="hljs-string">'})()'</span> : <span class="hljs-string">'{}'</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-313">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-313">&#182;</a>
              </div>
              <p>Remove the contents of the component’s <code>style</code> tag.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getStyle</span><span class="hljs-params">(str)</span></span>{
  <span class="hljs-keyword">return</span> (str.indexOf(<span class="hljs-string">'&lt;style&gt;'</span>) &gt; -<span class="hljs-number">1</span> &amp;&amp; str.indexOf(<span class="hljs-string">'&lt;/style&gt;'</span>) &gt; -<span class="hljs-number">1</span>) ? str.replace(<span class="hljs-regexp">/(.*&lt;style&gt;)(.*)(&lt;\/style&gt;.*)/ig</span>, <span class="hljs-string">'$2'</span>).replace(<span class="hljs-regexp">/"/g</span>, <span class="hljs-string">'\\"'</span>) : <span class="hljs-string">''</span>;
}</pre></div></div>
            
        </li>
        
        
        <li id="section-314">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-314">&#182;</a>
              </div>
              <p>Remove the contents of the component’s <code>template</code> tag.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getTemplate</span><span class="hljs-params">(str)</span></span>{
  <span class="hljs-keyword">return</span> str.replace(<span class="hljs-regexp">/.*&lt;template&gt;(.*)&lt;\/template&gt;.*/gi</span>, <span class="hljs-string">'$1'</span>).replace(<span class="hljs-regexp">/(.*)&lt;style&gt;.*&lt;\/style&gt;(.*)/ig</span>, <span class="hljs-string">'$1$2'</span>);
}</pre></div></div>
            
        </li>
        
        
        <li id="section-315">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-315">&#182;</a>
              </div>
              <p>Get the component’s name from its <code>name</code> attribute.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getName</span><span class="hljs-params">(str)</span></span>{
  <span class="hljs-keyword">return</span> str.replace(<span class="hljs-regexp">/.*&lt;element[^&gt;]*name=(["'])?([^'"&gt;\s]+)\1[^&lt;&gt;]*&gt;.*/ig</span>, <span class="hljs-string">'$2'</span>);
}</pre></div></div>
            
        </li>
        
        
        <li id="section-316">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-316">&#182;</a>
              </div>
              <p>Minify the string passed in by replacing all whitespace.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">minify</span><span class="hljs-params">(str)</span></span>{
  <span class="hljs-keyword">return</span> str.replace(<span class="hljs-regexp">/\s+/g</span>, <span class="hljs-string">' '</span>).replace(<span class="hljs-regexp">/\n|(&gt;) (&lt;)/g</span>, <span class="hljs-string">'$1$2'</span>);
}</pre></div></div>
            
        </li>
        
        
        <li id="section-317">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-317">&#182;</a>
              </div>
              <p>Strip javascript comments</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">removeComments</span><span class="hljs-params">(str)</span></span>{
  <span class="hljs-keyword">return</span> str.replace(<span class="hljs-regexp">/(?:\/\*(?:[\s\S]*?)\*\/)|(?:([\s])+\/\/(?:.*)$)/gm</span>, <span class="hljs-string">'$1'</span>);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">templateFunc</span><span class="hljs-params">(fn)</span> </span>{
  <span class="hljs-keyword">var</span> src = fn.toString();
  src = src.slice(src.indexOf(<span class="hljs-string">"{"</span>) + <span class="hljs-number">1</span>, -<span class="hljs-number">1</span>);
  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(data)</span> </span>{
    <span class="hljs-keyword">return</span> !data ? src : src.replace(<span class="hljs-regexp">/(\$[a-zA-Z]+)/g</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">($rep)</span> </span>{
      <span class="hljs-keyword">var</span> key = $rep.slice(<span class="hljs-number">1</span>);
      <span class="hljs-keyword">return</span> data[key] || <span class="hljs-string">""</span>;
    });
  };
}

<span class="hljs-keyword">var</span> COMPONENT_TEMPLATE = templateFunc(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">return</span> (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">window</span>.Rebound.registerComponent(<span class="hljs-string">"$name"</span>, {
      prototype: $script,
      template: $template,
      style: <span class="hljs-string">"$style"</span>
    });
  })();
});

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">precompile</span><span class="hljs-params">(str, options)</span></span>{
  <span class="hljs-keyword">if</span>( !str || str.length === <span class="hljs-number">0</span> ){
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">console</span>.error(<span class="hljs-string">'No template provided!'</span>);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-318">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-318">&#182;</a>
              </div>
              <p>Remove comments</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  str = removeComments(str);</pre></div></div>
            
        </li>
        
        
        <li id="section-319">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-319">&#182;</a>
              </div>
              <p>Minify everything</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  str = minify(str);

  options = options || {};
  options.baseDest = options.baseDest || <span class="hljs-string">''</span>;
  options.name = options.name || <span class="hljs-string">''</span>;
  options.baseUrl = options.baseUrl || <span class="hljs-string">''</span>;

  <span class="hljs-keyword">var</span> template = str,
      style = <span class="hljs-string">''</span>,
      script = <span class="hljs-string">'{}'</span>,
      name = <span class="hljs-string">''</span>,
      isPartial = <span class="hljs-literal">true</span>,
      imports = [],
      partials,
      <span class="hljs-built_in">require</span>,
      deps = [];</pre></div></div>
            
        </li>
        
        
        <li id="section-320">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-320">&#182;</a>
              </div>
              <p>If the element tag is present</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span>(str.indexOf(<span class="hljs-string">'&lt;element'</span>) &gt; -<span class="hljs-number">1</span> &amp;&amp; str.indexOf(<span class="hljs-string">'&lt;/element&gt;'</span>) &gt; -<span class="hljs-number">1</span>){

    isPartial = <span class="hljs-literal">false</span>;

    name = getName(str);
    style = getStyle(str);
    template = getTemplate(str);
    script = getScript(str);

  }</pre></div></div>
            
        </li>
        
        
        <li id="section-321">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-321">&#182;</a>
              </div>
              <p>Assemple our component dependancies by finding link tags and parsing their src</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> importsre = <span class="hljs-regexp">/&lt;link [^h]*href=(['"]?)\/?([^.'"]*).html\1[^&gt;]*&gt;/gi</span>,
      match;

  <span class="hljs-keyword">while</span> ((match = importsre.exec(template)) != <span class="hljs-literal">null</span>) {
      imports.push(match[<span class="hljs-number">2</span>]);
  }
  imports.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(importString, index)</span></span>{
    deps.push(<span class="hljs-string">'"'</span> + options.baseDest + importString + <span class="hljs-string">'"'</span>);
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-322">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-322">&#182;</a>
              </div>
              <p>Remove link tags from template</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  template = template.replace(<span class="hljs-regexp">/&lt;link .*href=(['"]?)(.*).html\1[^&gt;]*&gt;/gi</span>, <span class="hljs-string">''</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-323">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-323">&#182;</a>
              </div>
              <p>Assemble our partial dependancies</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  partials = template.match(<span class="hljs-regexp">/\{\{&gt;\s*?['"]?([^'"}\s]*)['"]?\s*?\}\}/gi</span>);

  <span class="hljs-keyword">if</span>(partials){
    partials.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(partial, index)</span></span>{
      deps.push(<span class="hljs-string">'"'</span> + options.baseDest + partial.replace(<span class="hljs-regexp">/\{\{&gt;[\s*]?['"]?([^'"]*)['"]?[\s*]?\}\}/gi</span>, <span class="hljs-string">'$1'</span>) + <span class="hljs-string">'"'</span>);
    });
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-324">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-324">&#182;</a>
              </div>
              <p>Compile</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  template = <span class="hljs-string">''</span> + htmlbarsCompileSpec(template);</pre></div></div>
            
        </li>
        
        
        <li id="section-325">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-325">&#182;</a>
              </div>
              <p>If is a partial</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span>(isPartial){
    template = <span class="hljs-string">'(function(){var template = '</span>+template+<span class="hljs-string">'\n window.Rebound.registerPartial( "'</span>+ options.name +<span class="hljs-string">'", template);})();\n'</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-326">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-326">&#182;</a>
              </div>
              <p>Else, is a component</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">else</span>{
    template = COMPONENT_TEMPLATE({
      name: name,
      script: script,
      style: style,
      template: template
    });
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-327">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-327">&#182;</a>
              </div>
              <p>Wrap in define</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  template = <span class="hljs-string">"define( ["</span>+ deps.join(<span class="hljs-string">', '</span>)  +<span class="hljs-string">"], function(){\n"</span> + template + <span class="hljs-string">'});'</span>;

  <span class="hljs-keyword">return</span> template;
}

export { precompile };</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
